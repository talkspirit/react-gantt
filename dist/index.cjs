"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const l=require("react/jsx-runtime"),e=require("react"),se=require("@svar-ui/react-core"),ie=require("@svar-ui/lib-dom"),Ie=require("@svar-ui/gantt-locales"),Ge=require("@svar-ui/core-locales"),Be=require("@svar-ui/lib-state"),te=require("@svar-ui/gantt-store"),p=require("@svar-ui/lib-react"),Fe=require("@svar-ui/grid-store"),Ve=require("@svar-ui/react-grid"),Xe=require("react-dom"),Pe=require("@svar-ui/react-toolbar"),Ye=require("@svar-ui/react-menu"),Me=require("@svar-ui/react-editor"),je=e.createContext(null);function Ne(s){const r=s.getAttribute("data-id"),o=parseInt(r);return isNaN(o)||o.toString()!=r?r:o}function Qe(s,r,o){const n=s.getBoundingClientRect(),c=r.querySelector(".wx-body").getBoundingClientRect();return{top:n.top-c.top,left:n.left-c.left,dt:n.bottom-o.clientY,db:o.clientY-n.top}}function We(s){return s&&s.getAttribute("data-context-id")}const Oe=5;function Ue(s,r){let o,n,c,M,m,x,g,R,h;function z(d){M=d.clientX,m=d.clientY,x={...Qe(o,s,d),y:r.getTask(c).$y},document.body.style.userSelect="none"}function C(d){o=ie.locate(d),We(o)&&(c=Ne(o),h=setTimeout(()=>{R=!0,r&&r.touchStart&&r.touchStart(),z(d.touches[0])},500),s.addEventListener("touchmove",H),s.addEventListener("contextmenu",u),window.addEventListener("touchend",I))}function u(d){if(R||h)return d.preventDefault(),!1}function W(d){d.which===1&&(o=ie.locate(d),We(o)&&(c=Ne(o),s.addEventListener("mousemove",$),window.addEventListener("mouseup",S),z(d)))}function N(d){s.removeEventListener("mousemove",$),s.removeEventListener("touchmove",H),document.body.removeEventListener("mouseup",S),document.body.removeEventListener("touchend",I),document.body.style.userSelect="",d&&(s.removeEventListener("mousedown",W),s.removeEventListener("touchstart",C))}function P(d){const V=d.clientX-M,O=d.clientY-m;if(!n){if(Math.abs(V)<Oe&&Math.abs(O)<Oe||r&&r.start&&r.start({id:c,e:d})===!1)return;n=o.cloneNode(!0),n.style.pointerEvents="none",n.classList.add("wx-reorder-task"),n.style.position="absolute",n.style.left=x.left+"px",n.style.top=x.top+"px",o.style.visibility="hidden",o.parentNode.insertBefore(n,o)}if(n){const U=Math.round(Math.max(0,x.top+O));if(r&&r.move&&r.move({id:c,top:U,detail:g})===!1)return;const B=r.getTask(c),Y=B.$y;if(!x.start&&x.y==Y)return D();x.start=!0,x.y=B.$y-4,n.style.top=U+"px";const K=document.elementFromPoint(d.clientX,d.clientY),A=ie.locate(K);if(A&&A!==o){const Q=Ne(A),j=A.getBoundingClientRect(),a=j.top+j.height/2,k=d.clientY+x.db>a&&A.nextElementSibling!==o,G=d.clientY-x.dt<a&&A.previousElementSibling!==o;g?.after==Q||g?.before==Q?g=null:k?g={id:c,after:Q}:G&&(g={id:c,before:Q})}}}function $(d){P(d)}function H(d){R?(d.preventDefault(),P(d.touches[0])):h&&(clearTimeout(h),h=null)}function I(){R=null,h&&(clearTimeout(h),h=null),D()}function S(){D()}function D(){o&&(o.style.visibility=""),n&&(n.parentNode.removeChild(n),r&&r.end&&r.end({id:c,top:x.top})),c=o=n=x=g=null,N()}return s.style.position!=="absolute"&&(s.style.position="relative"),s.addEventListener("mousedown",W),s.addEventListener("touchstart",C),{destroy(){N(!0)}}}function Ze({row:s,column:r}){function o(c,M){return{justifyContent:M.align,paddingLeft:`${(c.$level-1)*20}px`}}const n=r&&r._cell;return l.jsxs("div",{className:"wx-pqc08MHU wx-content",style:o(s,r),children:[s.data||s.lazy?l.jsx("i",{className:`wx-pqc08MHU wx-toggle-icon wxi-menu-${s.open?"down":"right"}`,"data-action":"open-task"}):l.jsx("i",{className:"wx-pqc08MHU wx-toggle-placeholder"}),l.jsx("div",{className:"wx-pqc08MHU wx-text",children:n?l.jsx(n,{row:s,column:r}):s.text})]})}function _e({column:s,cell:r}){const o=e.useMemo(()=>s.id,[s?.id]);return r||s.id=="add-task"?l.jsx("div",{style:{textAlign:s.align},children:l.jsx("i",{className:"wx-9DAESAHW wx-action-icon wxi-plus","data-action":o})}):null}function Je(s){const{readonly:r,compactMode:o,width:n=0,display:c="all",columnWidth:M=0,onTableAPIChange:m}=s,[x,g]=p.useWritableProp(M),[R,h]=e.useState(),z=e.useContext(se.context.i18n),C=e.useMemo(()=>z.getGroup("gantt"),[z]),u=e.useContext(je),W=p.useStore(u,"scrollTop"),N=p.useStore(u,"cellHeight"),P=p.useStore(u,"_scrollTask"),$=p.useStore(u,"_selected"),H=p.useStore(u,"area"),I=p.useStore(u,"_tasks"),S=p.useStore(u,"_scales"),D=p.useStore(u,"columns"),d=p.useStore(u,"_sort"),V=p.useStore(u,"calendar"),O=p.useStore(u,"durationUnit"),U=p.useStore(u,"splitTasks"),[B,Y]=e.useState(null),K=e.useMemo(()=>!I||!H?[]:I.slice(H.start,H.end),[I,H]),A=e.useCallback((i,w)=>{if(w==="add-task")u.exec(w,{target:i,task:{text:C("New Task")},mode:"child",show:!0});else if(w==="open-task"){const T=K.find(t=>t.id===i);(T?.data||T?.lazy)&&u.exec(w,{id:i,mode:!T.open})}},[K]),Q=e.useCallback(i=>{const w=ie.locateID(i),T=i.target.dataset.action;T&&i.preventDefault(),w?T==="add-task"||T==="open-task"?A(w,T):u.exec("select-task",{id:w,toggle:i.ctrlKey||i.metaKey,range:i.shiftKey,show:!0}):T==="add-task"&&A(null,T)},[u,A]),j=e.useRef(null),a=e.useRef(null),[k,G]=e.useState(0),[L,q]=e.useState(!1);e.useEffect(()=>{const i=a.current;if(!i||typeof ResizeObserver>"u")return;const w=()=>G(i.clientWidth);w();const T=new ResizeObserver(w);return T.observe(i),()=>T.disconnect()},[]);const _=e.useRef(null),ae=e.useCallback(i=>{const w=i.id,{before:T,after:t}=i,f=i.onMove;let y=T||t,E=T?"before":"after";if(f){if(E==="after"){const X=u.getTask(y);X.data?.length&&X.open&&(E="before",y=X.data[0].id)}_.current={id:w,[E]:y}}else _.current=null;u.exec("move-task",{id:w,mode:E,target:y,inProgress:f})},[u]),ue=e.useMemo(()=>H?.from??0,[H]),de=e.useMemo(()=>S?.height??0,[S]),re=e.useMemo(()=>!o&&c!=="grid"?(x??0)>(n??0):(x??0)>(k??0),[o,c,x,n,k]),v=e.useMemo(()=>{const i={};return re&&c==="all"||c==="grid"&&re?i.width=x:c==="grid"&&(i.width="100%"),i},[re,c,x]),ee=e.useMemo(()=>B&&!K.find(i=>i.id===B.id)?[...K,B]:K,[K,B]),Z=e.useMemo(()=>{let i=(D||[]).map(t=>{t={...t};const f=t.header;if(typeof f=="object"){const y=f.text&&C(f.text);t.header={...f,text:y}}else t.header=C(f);return t});const w=i.findIndex(t=>t.id==="text"),T=i.findIndex(t=>t.id==="add-task");if(w!==-1&&(i[w].cell&&(i[w]._cell=i[w].cell),i[w].cell=Ze),T!==-1){i[T].cell=i[T].cell||_e;const t=i[T].header;if(typeof t!="object"&&(i[T].header={text:t}),i[T].header.cell=t.cell||_e,r)i.splice(T,1);else if(o){const[f]=i.splice(T,1);i.unshift(f)}}return i.length>0&&(i[i.length-1].resize=!1),i},[D,C,r,o]),ne=e.useMemo(()=>c==="all"?`${n}px`:c==="grid"?"calc(100% - 4px)":Z.find(i=>i.id==="add-task")?"50px":"0",[c,n,Z]),ke=e.useMemo(()=>{if(ee&&d?.length){const i={};return d.forEach(({key:w,order:T},t)=>{i[w]={order:T,...d.length>1&&{index:t}}}),i}return{}},[ee,d]),be=e.useCallback(()=>Z.some(i=>i.flexgrow&&!i.hidden),[]),ve=e.useMemo(()=>be(),[be,L]),xe=e.useMemo(()=>{let i=c==="chart"?Z.filter(T=>T.id==="add-task"):Z;const w=c==="all"?n:k;if(!ve){let T=x,t=!1;if(Z.some(f=>f.$width)){let f=0;T=Z.reduce((y,E)=>(E.hidden||(f+=E.width,y+=E.$width||E.width),y),0),f>T&&T>w&&(t=!0)}if(t||T<w){let f=1;return t||(f=(w-50)/(T-50||1)),i.map(y=>(y.id!=="add-task"&&!y.hidden&&(y.$width||(y.$width=y.width),y.width=y.$width*f),y))}}return i},[c,Z,ve,x,n,k]),pe=e.useCallback(i=>{if(!be()){const w=xe.reduce((T,t)=>(i&&t.$width&&(t.$width=t.width),T+(t.hidden?0:t.width)),0);w!==x&&g(w)}q(!0),q(!1)},[be,xe,x,g]),ye=e.useCallback(()=>{Z.filter(w=>w.flexgrow&&!w.hidden).length===1&&Z.forEach(w=>{w.$width&&!w.flexgrow&&!w.hidden&&(w.width=w.$width)})},[]),oe=e.useCallback(i=>{if(!r){const w=ie.locateID(i),T=ie.locateAttr(i,"data-col-id");!(T&&Z.find(f=>f.id==T))?.editor&&w&&u.exec("show-editor",{id:w})}},[u,r]),me=e.useMemo(()=>Array.isArray($)?$.map(i=>i.id):[],[$]),fe=e.useCallback(()=>{if(j.current&&ee!==null){const i=j.current.querySelector(".wx-body");i&&(i.style.top=-((W??0)-(ue??0))+"px")}a.current&&(a.current.scrollTop=0)},[ee,W,ue]);e.useEffect(()=>{j.current&&fe()},[W,ue,fe]),e.useEffect(()=>{const i=j.current;if(!i)return;const w=i.querySelector(".wx-table-box .wx-body");if(!w||typeof ResizeObserver>"u")return;const T=new ResizeObserver(()=>{fe()});return T.observe(w),()=>{T.disconnect()}},[xe,v,c,ne,ee,fe]),e.useEffect(()=>{if(!P||!R)return;const{id:i}=P,w=R.getState().focusCell;w&&w.row!==i&&j.current&&j.current.contains(document.activeElement)&&R.exec("focus-cell",{row:i,column:w.column})},[P,R]);const b=e.useCallback(({id:i})=>{if(r)return!1;u.getTask(i).open&&u.exec("open-task",{id:i,mode:!1});const w=u.getState()._tasks.find(T=>T.id===i);if(Y(w||null),!w)return!1},[u,r]),J=e.useCallback(({id:i,top:w})=>{_.current?ae({..._.current,onMove:!1}):u.exec("drag-task",{id:i,top:w+(ue??0),inProgress:!1}),Y(null)},[u,ae,ue]),le=e.useCallback(({id:i,top:w,detail:T})=>{T&&ae({...T,onMove:!0}),u.exec("drag-task",{id:i,top:w+(ue??0),inProgress:!0})},[u,ae,ue]);e.useEffect(()=>{const i=j.current;return i?Ue(i,{start:b,end:J,move:le,getTask:u.getTask}).destroy:void 0},[u,b,J,le]);const F=e.useCallback(i=>{const{key:w,isInput:T}=i;if(!T&&(w==="arrowup"||w==="arrowdown"))return i.eventSource="grid",u.exec("hotkey",i),!1;if(w==="enter"){const t=R?.getState().focusCell;if(t){const{row:f,column:y}=t;y==="add-task"?A(f,"add-task"):y==="text"&&A(f,"open-task")}}},[u,A,R]),ce=e.useRef(null),Te=()=>{ce.current={setTableAPI:h,handleHotkey:F,sortVal:d,api:u,adjustColumns:ye,setColumnWidth:pe,tasks:K,calendarVal:V,durationUnitVal:O,splitTasksVal:U,onTableAPIChange:m}};Te(),e.useEffect(()=>{Te()},[h,F,d,u,ye,pe,K,V,O,U,m]);const $e=e.useCallback(i=>{h(i),i.intercept("hotkey",w=>ce.current.handleHotkey(w)),i.intercept("scroll",()=>!1),i.intercept("select-row",()=>!1),i.intercept("sort-rows",w=>{const T=ce.current.sortVal,{key:t,add:f}=w,y=T?T.find(X=>X.key===t):null;let E="asc";return y&&(E=!y||y.order==="asc"?"desc":"asc"),u.exec("sort-tasks",{key:t,order:E,add:f}),!1}),i.on("resize-column",()=>{ce.current.setColumnWidth(!0)}),i.on("hide-column",w=>{w.mode||ce.current.adjustColumns(),ce.current.setColumnWidth()}),i.intercept("update-cell",w=>{const{id:T,column:t,value:f}=w,y=ce.current.tasks.find(E=>E.id===T);if(y){const E={...y};let X=f;X&&!isNaN(X)&&!(X instanceof Date)&&(X*=1),E[t]=X,te.prepareEditTask(E,{calendar:ce.current.calendarVal,durationUnit:ce.current.durationUnitVal,splitTasks:ce.current.splitTasksVal},t),u.exec("update-task",{id:T,task:E})}return!1}),m&&m(i)},[]);return l.jsx("div",{className:"wx-rHj6070p wx-table-container",style:{flex:`0 0 ${ne}`},ref:a,children:l.jsx("div",{ref:j,style:v,className:"wx-rHj6070p wx-table",onClick:Q,onDoubleClick:oe,children:l.jsx(Ve.Grid,{init:$e,sizes:{rowHeight:N,headerHeight:(de??0)-1},rowStyle:i=>i.$reorder?"wx-rHj6070p wx-reorder-task":"wx-rHj6070p",columnStyle:i=>`wx-rHj6070p wx-text-${i.align}${i.id==="add-task"?" wx-action":""}`,data:ee,columns:xe,selectedRows:[...me],sortMarks:ke})})})}function et({borders:s=""}){const r=e.useContext(je),o=p.useStore(r,"cellWidth"),n=p.useStore(r,"cellHeight"),c=e.useRef(null),[M,m]=e.useState("#e4e4e4");e.useEffect(()=>{if(typeof getComputedStyle<"u"&&c.current){const g=getComputedStyle(c.current).getPropertyValue("--wx-gantt-border");m(g?g.substring(g.indexOf("#")):"#1d1e261a")}},[]);const x={width:"100%",height:"100%",background:o!=null&&n!=null?`url(${te.grid(o,n,M,s)})`:void 0,position:"absolute"};return l.jsx("div",{ref:c,style:x})}function tt({onSelectLink:s,selectedLink:r,readonly:o}){const n=e.useContext(je),c=p.useStore(n,"_links"),M=p.useStore(n,"criticalPath"),m=e.useRef(null),x=e.useCallback(g=>{const R=g?.target?.classList;!R?.contains("wx-line")&&!R?.contains("wx-delete-button")&&s(null)},[s]);return e.useEffect(()=>{if(!o&&r&&m.current){const g=R=>{m.current&&!m.current.contains(R.target)&&x(R)};return document.addEventListener("click",g),()=>{document.removeEventListener("click",g)}}},[o,r,x]),l.jsxs("svg",{className:"wx-dkx3NwEn wx-links",children:[(c||[]).map(g=>{const R="wx-dkx3NwEn wx-line"+(M&&g.$critical?" wx-critical":"")+(o?"":" wx-line-selectable");return l.jsx("polyline",{className:R,points:g.$p,onClick:()=>!o&&s(g.id),"data-link-id":g.id},g.id)}),!o&&r&&l.jsx("polyline",{ref:m,className:"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link",points:r.$p})]})}function st(s){const{task:r,type:o}=s;function n(M){const m=r.segments[M];return{left:`${m.$x}px`,top:"0px",width:`${m.$w}px`,height:"100%"}}function c(M){if(!r.progress)return 0;const m=r.duration*r.progress/100,x=r.segments;let g=0,R=0,h=null;do{const z=x[R];R===M&&(g>m?h=0:h=Math.min((m-g)/z.duration,1)*100),g+=z.duration,R++}while(h===null&&R<x.length);return h||0}return l.jsx("div",{className:"wx-segments wx-GKbcLEGA",children:r.segments.map((M,m)=>l.jsxs("div",{className:`wx-segment wx-bar wx-${o} wx-GKbcLEGA`,"data-segment":m,style:n(m),children:[r.progress?l.jsx("div",{className:"wx-progress-wrapper",children:l.jsx("div",{className:"wx-progress-percent wx-GKbcLEGA",style:{width:`${c(m)}%`}})}):null,l.jsx("div",{className:"wx-content",children:M.text||""})]},m))})}function nt(s){const{readonly:r,taskTemplate:o}=s,n=e.useContext(je),[c,M]=p.useStoreWithCounter(n,"_tasks"),[m,x]=p.useStoreWithCounter(n,"_links"),g=p.useStore(n,"area"),R=p.useStore(n,"_scales"),h=p.useStore(n,"taskTypes"),z=p.useStore(n,"baselines"),C=p.useStore(n,"_selected"),u=p.useStore(n,"_scrollTask"),W=p.useStore(n,"criticalPath"),N=p.useStore(n,"tasks"),P=p.useStore(n,"schedule"),$=p.useStore(n,"splitTasks"),H=p.useStore(n,"summary"),I=e.useMemo(()=>{if(!g||!Array.isArray(c))return[];const t=g.start??0,f=g.end??0;return c.slice(t,f).map(y=>({...y}))},[M,g]),S=e.useMemo(()=>R.lengthUnitWidth,[R]),D=e.useRef(!1),[d,V]=e.useState(void 0),[O,U]=e.useState(null),B=e.useRef(null),[Y,K]=e.useState(null),A=e.useMemo(()=>Y&&{...m.find(t=>t.id===Y)},[Y,x]),[Q,j]=e.useState(void 0),a=e.useRef(null),[k,G]=e.useState(0),L=e.useRef(null),q=e.useMemo(()=>{const t=L.current;return!!(C.length&&t&&t.contains(document.activeElement))},[C,L.current]),_=e.useMemo(()=>q&&C[C.length-1]?.id,[q,C]);e.useEffect(()=>{if(u&&q&&u){const{id:t}=u,f=L.current?.querySelector(`.wx-bar[data-id='${t}']`);f&&f.focus({preventScroll:!0})}},[u]),e.useEffect(()=>{const t=L.current;if(t&&(G(t.offsetWidth||0),typeof ResizeObserver<"u")){const f=new ResizeObserver(y=>{y[0]&&G(y[0].contentRect.width)});return f.observe(t),()=>f.disconnect()}},[L.current]);const ae=e.useCallback(()=>{document.body.style.userSelect="none"},[]),ue=e.useCallback(()=>{document.body.style.userSelect=""},[]),de=e.useCallback((t,f,y)=>{if(f.target.classList.contains("wx-line")||(y||(y=n.getTask(Ne(t))),y.type==="milestone"||y.type==="summary"))return"";const E=ie.locate(f,"data-segment");E&&(t=E);const{left:X,width:he}=t.getBoundingClientRect(),ge=(f.clientX-X)/he;let we=.2/(he>200?he/200:1);return ge<we?"start":ge>1-we?"end":""},[n]),re=e.useCallback((t,f)=>{const{clientX:y}=f,E=Ne(t),X=n.getTask(E),he=f.target.classList;if(!f.target.closest(".wx-delete-button")&&!f.target.closest("[data-interactive]")&&!r){if(he.contains("wx-progress-marker")){const{progress:ge}=n.getTask(E);B.current={id:E,x:y,progress:ge,dx:0,node:t,marker:f.target},f.target.classList.add("wx-progress-in-drag")}else{const ge=de(t,f,X)||"move",we={id:E,mode:ge,x:y,dx:0,l:X.$x,w:X.$w};if($&&X.segments?.length){const Ce=ie.locate(f,"data-segment");Ce&&(we.segmentIndex=Ce.dataset.segment*1,te.extendDragOptions(X,we))}U(we)}ae()}},[n,r,de,ae,$]),v=e.useCallback(t=>{if(t.button!==0)return;const f=ie.locate(t);f&&re(f,t)},[re]),ee=e.useCallback(t=>{const f=ie.locate(t);f&&(a.current=setTimeout(()=>{j(!0),re(f,t.touches[0])},300))},[re]),Z=e.useCallback(t=>{K(t)},[]),ne=e.useCallback(()=>{if(B.current){const{dx:t,id:f,marker:y,value:E}=B.current;B.current=null,typeof E<"u"&&t&&n.exec("update-task",{id:f,task:{progress:E},inProgress:!1}),y.classList.remove("wx-progress-in-drag"),D.current=!0,ue()}else if(O){const{id:t,mode:f,dx:y,l:E,w:X,start:he,segment:ge,index:we}=O;if(U(null),he){const Ce=Math.round(y/S);if(!Ce)n.exec("drag-task",{id:t,width:X,left:E,inProgress:!1,...ge&&{segmentIndex:we}});else{let Re={},Ee=n.getTask(t);ge&&(Ee=Ee.segments[we]),f==="move"?(Re.start=Ee.start,Re.end=Ee.end):Re[f]=Ee[f],n.exec("update-task",{id:t,diff:Ce,task:Re,...ge&&{segmentIndex:we}})}D.current=!0}ue()}},[n,ue,O,S]),ke=e.useCallback((t,f)=>{const{clientX:y}=f;if(!r)if(B.current){const{node:E,x:X,id:he}=B.current,ge=B.current.dx=y-X,we=Math.round(ge/E.offsetWidth*100);let Ce=B.current.progress+we;B.current.value=Ce=Math.min(Math.max(0,Ce),100),n.exec("update-task",{id:he,task:{progress:Ce},inProgress:!0})}else if(O){Z(null);const{mode:E,l:X,w:he,x:ge,id:we,start:Ce,segment:Re,index:Ee}=O,Ae=n.getTask(we),Se=y-ge,ze=Math.round(S)||1;if(!Ce&&Math.abs(Se)<20||E==="start"&&he-Se<ze||E==="end"&&he+Se<ze||E==="move"&&(Se<0&&X+Se<0||Se>0&&X+he+Se>k)||O.segment&&!te.isSegmentMoveAllowed(Ae,O))return;const He={...O,dx:Se};let Le,De;if(E==="start"?(Le=X+Se,De=he-Se):E==="end"?(Le=X,De=he+Se):E==="move"&&(Le=X+Se,De=he),n.exec("drag-task",{id:we,width:De,left:Le,inProgress:!0,start:Ce,...Re&&{segmentIndex:Ee}}),!He.start&&(E==="move"&&Ae.$x==X||E!=="move"&&Ae.$w==he)){D.current=!0,ne();return}He.start=!0,U(He)}else{const E=ie.locate(t);if(E){const X=n.getTask(Ne(E)),ge=ie.locate(t,"data-segment")||E,we=de(ge,f,X);ge.style.cursor=we&&!r?"col-resize":"pointer"}}},[n,r,O,S,k,de,Z,ne]),be=e.useCallback(t=>{ke(t,t)},[ke]),ve=e.useCallback(t=>{Q?(t.preventDefault(),ke(t,t.touches[0])):a.current&&(clearTimeout(a.current),a.current=null)},[Q,ke]),xe=e.useCallback(()=>{ne()},[ne]),pe=e.useCallback(()=>{j(null),a.current&&(clearTimeout(a.current),a.current=null),ne()},[ne]);e.useEffect(()=>(window.addEventListener("mouseup",xe),()=>{window.removeEventListener("mouseup",xe)}),[xe]);const ye=e.useCallback(t=>{if(!r){if(t.target.closest("[data-interactive]"))return;const f=ie.locateID(t.target);if(f&&!t.target.classList.contains("wx-link")){const y=ie.locateID(t.target,"data-segment");n.exec("show-editor",{id:f,...y!==null&&{segmentIndex:y}})}}},[n,r]),oe=["e2s","s2s","e2e","s2e"],me=e.useCallback((t,f)=>oe[(t?1:0)+(f?0:2)],[]),fe=e.useCallback((t,f)=>{const y=d.id,E=d.start;return t===y?!0:!!m.find(X=>X.target==t&&X.source==y&&X.type===me(E,f))},[d,x,me]),b=e.useCallback(()=>{d&&V(null)},[d]),J=e.useCallback(t=>{if(D.current){D.current=!1;return}if(t.target.closest("[data-interactive]"))return;const f=ie.locateID(t.target);if(f){const y=t.target.classList;if(y.contains("wx-link")){const E=y.contains("wx-left");if(!d){V({id:f,start:E});return}d.id!==f&&!fe(f,E)&&n.exec("add-link",{link:{source:d.id,target:f,type:me(d.start,E)}})}else if(y.contains("wx-delete-button-icon"))n.exec("delete-link",{id:Y}),K(null);else{let E;const X=ie.locate(t,"data-segment");X&&(E=X.dataset.segment*1),n.exec("select-task",{id:f,toggle:t.ctrlKey||t.metaKey,range:t.shiftKey,segmentIndex:E})}}b()},[n,d,x,A,fe,me,b]),le=e.useCallback(t=>({left:`${t.$x}px`,top:`${t.$y}px`,width:`${t.$w}px`,height:`${t.$h}px`}),[]),F=e.useCallback(t=>({left:`${t.$x_base}px`,top:`${t.$y_base}px`,width:`${t.$w_base}px`,height:`${t.$h_base}px`}),[]),ce=e.useCallback(t=>{if(Q||a.current)return t.preventDefault(),!1},[Q]),Te=e.useMemo(()=>h.map(t=>t.id),[h]),$e=e.useCallback(t=>{let f=Te.includes(t)?t:"task";return["task","milestone","summary"].includes(t)||(f=`task ${f}`),f},[Te]),i=e.useCallback(t=>{n.exec(t.action,t.data)},[n]),w=e.useCallback(t=>W&&N.byId(t).$critical,[W,N]),T=e.useCallback(t=>{if(P?.auto){const f=N.getSummaryId(t,!0),y=N.getSummaryId(d.id,!0);return d?.id&&!(Array.isArray(f)?f:[f]).includes(d.id)&&!(Array.isArray(y)?y:[y]).includes(t)}return d},[P,N,d]);return l.jsxs("div",{className:"wx-GKbcLEGA wx-bars",style:{lineHeight:`${I.length?I[0].$h:0}px`},ref:L,onContextMenu:ce,onMouseDown:v,onMouseMove:be,onTouchStart:ee,onTouchMove:ve,onTouchEnd:pe,onClick:J,onDoubleClick:ye,onDragStart:t=>(t.preventDefault(),!1),children:[l.jsx(tt,{onSelectLink:Z,selectedLink:A,readonly:r}),I.map(t=>{if(t.$skip&&t.$skip_baseline)return null;const f=`wx-bar wx-${$e(t.type)}`+(Q&&O&&t.id===O.id?" wx-touch":"")+(d&&d.id===t.id?" wx-selected":"")+(w(t.id)?" wx-critical":"")+(t.$reorder?" wx-reorder-task":"")+($&&t.segments?" wx-split":""),y="wx-link wx-left"+(d?" wx-visible":"")+(!d||!fe(t.id,!0)&&T(t.id)?" wx-target":"")+(d&&d.id===t.id&&d.start?" wx-selected":"")+(w(t.id)?" wx-critical":""),E="wx-link wx-right"+(d?" wx-visible":"")+(!d||!fe(t.id,!1)&&T(t.id)?" wx-target":"")+(d&&d.id===t.id&&!d.start?" wx-selected":"")+(w(t.id)?" wx-critical":"");return l.jsxs(e.Fragment,{children:[!t.$skip&&l.jsxs("div",{className:"wx-GKbcLEGA "+f,style:le(t),"data-tooltip-id":t.id,"data-id":t.id,tabIndex:_===t.id?0:-1,children:[r?null:t.id===A?.target&&A?.type[2]==="s"?l.jsx(se.Button,{type:"danger",css:"wx-left wx-delete-button wx-delete-link",children:l.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):l.jsx("div",{className:"wx-GKbcLEGA "+y,children:l.jsx("div",{className:"wx-GKbcLEGA wx-inner"})}),t.type!=="milestone"?l.jsxs(l.Fragment,{children:[t.progress&&!($&&t.segments)?l.jsx("div",{className:"wx-GKbcLEGA wx-progress-wrapper",children:l.jsx("div",{className:"wx-GKbcLEGA wx-progress-percent",style:{width:`${t.progress}%`}})}):null,!r&&!($&&t.segments)&&!(t.type=="summary"&&H?.autoProgress)?l.jsx("div",{className:"wx-GKbcLEGA wx-progress-marker",style:{left:`calc(${t.progress}% - 10px)`},children:t.progress}):null,o?l.jsx("div",{className:"wx-GKbcLEGA wx-content",children:l.jsx(o,{data:t,api:n,onAction:i})}):$&&t.segments?l.jsx(st,{task:t,type:$e(t.type)}):l.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text||""})]}):l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"wx-GKbcLEGA wx-content"}),o?l.jsx(o,{data:t,api:n,onAction:i}):l.jsx("div",{className:"wx-GKbcLEGA wx-text-out",children:t.text})]}),r?null:t.id===A?.target&&A?.type[2]==="e"?l.jsx(se.Button,{type:"danger",css:"wx-right wx-delete-button wx-delete-link",children:l.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):l.jsx("div",{className:"wx-GKbcLEGA "+E,children:l.jsx("div",{className:"wx-GKbcLEGA wx-inner"})})]}),z&&!t.$skip_baseline?l.jsx("div",{className:"wx-GKbcLEGA wx-baseline"+(t.type==="milestone"?" wx-milestone":""),style:F(t)}):null]},t.id)})]})}function rt(s){const{highlightTime:r}=s,o=e.useContext(je),n=p.useStore(o,"_scales");return l.jsx("div",{className:"wx-ZkvhDKir wx-scale",style:{width:n.width},children:(n?.rows||[]).map((c,M)=>l.jsx("div",{className:"wx-ZkvhDKir wx-row",style:{height:`${c.height}px`},children:(c.cells||[]).map((m,x)=>{const g=r?r(m.date,m.unit):"",R="wx-cell "+(m.css||"")+" "+(g||"");return l.jsx("div",{className:"wx-ZkvhDKir "+R,style:{width:`${m.width}px`},children:m.value},x)})},M))})}const ot=new Map;function lt(s){const r=e.useRef(null),o=e.useRef(0),n=e.useRef(null),c=typeof window<"u"&&window.__RENDER_METRICS_ENABLED__;r.current===null&&(r.current=performance.now()),o.current++,e.useEffect(()=>{if(c)return cancelAnimationFrame(n.current),n.current=requestAnimationFrame(()=>{const M={label:s,time:performance.now()-r.current,renders:o.current,timestamp:Date.now()};ot.set(s,M),window.dispatchEvent(new CustomEvent("render-metric",{detail:M}))}),()=>cancelAnimationFrame(n.current)})}function ct(s){const{readonly:r,fullWidth:o,fullHeight:n,taskTemplate:c,cellBorders:M,highlightTime:m}=s,x=e.useContext(je),[g,R]=p.useStoreWithCounter(x,"_selected"),h=p.useStore(x,"scrollTop"),z=p.useStore(x,"cellHeight"),C=p.useStore(x,"cellWidth"),u=p.useStore(x,"_scales"),W=p.useStore(x,"_markers"),N=p.useStore(x,"_scrollTask"),P=p.useStore(x,"zoom"),[$,H]=e.useState(),I=e.useRef(null),S=1+(u?.rows?.length||0),D=e.useMemo(()=>{const a=[];return g&&g.length&&z&&g.forEach(k=>{a.push({height:`${z}px`,top:`${k.$y-3}px`})}),a},[R,z]),d=e.useMemo(()=>Math.max($||0,n),[$,n]);e.useEffect(()=>{const a=I.current;a&&typeof h=="number"&&(a.scrollTop=h)},[h]);const V=()=>{O()};function O(a){const k=I.current;if(!k)return;const G={};G.left=k.scrollLeft,x.exec("scroll-chart",G)}function U(){const a=I.current,G=Math.ceil(($||0)/(z||1))+1,L=Math.floor((a&&a.scrollTop||0)/(z||1)),q=Math.max(0,L-S),_=L+G+S,ae=q*(z||0);x.exec("render-data",{start:q,end:_,from:ae})}e.useEffect(()=>{U()},[$,h]);const B=e.useCallback(a=>{if(!a)return;const{id:k,mode:G}=a;if(G.toString().indexOf("x")<0)return;const L=I.current;if(!L)return;const{clientWidth:q}=L,_=x.getTask(k);if(_.$x+_.$w<L.scrollLeft)x.exec("scroll-chart",{left:_.$x-(C||0)}),L.scrollLeft=_.$x-(C||0);else if(_.$x>=q+L.scrollLeft){const ae=q<_.$w?C||0:_.$w;x.exec("scroll-chart",{left:_.$x-q+ae}),L.scrollLeft=_.$x-q+ae}},[x,C]);e.useEffect(()=>{B(N)},[N]);function Y(a){if(P&&(a.ctrlKey||a.metaKey)){a.preventDefault();const k=I.current,G=-Math.sign(a.deltaY),L=a.clientX-(k?k.getBoundingClientRect().left:0);x.exec("zoom-scale",{dir:G,offset:L})}}function K(a){const k=m(a.date,a.unit);return k?{css:k,width:a.width}:null}const A=e.useMemo(()=>u&&(u.minUnit==="hour"||u.minUnit==="day")&&m?u.rows[u.rows.length-1].cells.map(K):null,[u,m]),Q=e.useCallback(a=>{a.eventSource="chart",x.exec("hotkey",a)},[x]);e.useEffect(()=>{const a=I.current;if(!a)return;const k=()=>H(a.clientHeight);k();const G=new ResizeObserver(()=>k());return G.observe(a),()=>{G.disconnect()}},[I.current]);const j=e.useRef(null);return e.useEffect(()=>{const a=I.current;if(a&&!j.current)return j.current=Fe.hotkeys(a,{keys:{arrowup:!0,arrowdown:!0},exec:k=>Q(k)}),()=>{j.current?.destroy(),j.current=null}},[]),e.useEffect(()=>{const a=I.current;if(!a)return;const k=Y;return a.addEventListener("wheel",k),()=>{a.removeEventListener("wheel",k)}},[Y]),lt("chart"),l.jsxs("div",{className:"wx-mR7v2Xag wx-chart",tabIndex:-1,ref:I,onScroll:V,children:[l.jsx(rt,{highlightTime:m,scales:u}),W&&W.length?l.jsx("div",{className:"wx-mR7v2Xag wx-markers",style:{height:`${d}px`},children:W.map((a,k)=>l.jsx("div",{className:`wx-mR7v2Xag wx-marker ${a.css||""}`,style:{left:`${a.left}px`},children:l.jsx("div",{className:"wx-mR7v2Xag wx-content",children:a.text})},k))}):null,l.jsxs("div",{className:"wx-mR7v2Xag wx-area",style:{width:`${o}px`,height:`${d}px`},children:[A?l.jsx("div",{className:"wx-mR7v2Xag wx-gantt-holidays",style:{height:"100%"},children:A.map((a,k)=>a?l.jsx("div",{className:"wx-mR7v2Xag "+a.css,style:{width:`${a.width}px`,left:`${k*a.width}px`}},k):null)}):null,l.jsx(et,{borders:M}),g&&g.length?g.map((a,k)=>a.$y?l.jsx("div",{className:"wx-mR7v2Xag wx-selected","data-id":a.id,style:D[k]},a.id):null):null,l.jsx(nt,{readonly:r,taskTemplate:c})]})]})}function it(s){const{position:r="after",size:o=4,dir:n="x",onMove:c,onDisplayChange:M,compactMode:m,containerWidth:x=0,leftThreshold:g=50,rightThreshold:R=50}=s,[h,z]=p.useWritableProp(s.value??0),[C,u]=p.useWritableProp(s.display??"all");function W(G){let L=0;r=="center"?L=o/2:r=="before"&&(L=o);const q={size:[o+"px","auto"],p:[G-L+"px","0px"],p2:["auto","0px"]};if(n!="x")for(let _ in q)q[_]=q[_].reverse();return q}const[N,P]=e.useState(!1),[$,H]=e.useState(null),I=e.useRef(0),S=e.useRef(),D=e.useRef(),d=e.useRef(C);e.useEffect(()=>{d.current=C},[C]),e.useEffect(()=>{$===null&&h>0&&H(h)},[$,h]);function V(G){return n=="x"?G.clientX:G.clientY}const O=e.useCallback(G=>{const L=S.current+V(G)-I.current;z(L);let q;L<=g?q="chart":x-L<=R?q="grid":q="all",d.current!==q&&(u(q),d.current=q),D.current&&clearTimeout(D.current),D.current=setTimeout(()=>c&&c(L),100)},[x,g,R,c]),U=e.useCallback(()=>{document.body.style.cursor="",document.body.style.userSelect="",P(!1),window.removeEventListener("mousemove",O),window.removeEventListener("mouseup",U)},[O]),B=e.useMemo(()=>C!=="all"?"auto":n=="x"?"ew-resize":"ns-resize",[C,n]),Y=e.useCallback(G=>{!m&&(C==="grid"||C==="chart")||(I.current=V(G),S.current=h,P(!0),document.body.style.cursor=B,document.body.style.userSelect="none",window.addEventListener("mousemove",O),window.addEventListener("mouseup",U))},[B,O,U,h,m,C]);function K(){u("all"),$!==null&&(z($),c&&c($))}function A(G){if(m){const L=C==="chart"?"grid":"chart";u(L),M(L)}else if(C==="grid"||C==="chart")K(),M("all");else{const L=G==="left"?"chart":"grid";u(L),M(L)}}function Q(){A("left")}function j(){A("right")}const a=e.useMemo(()=>W(h),[h,r,o,n]),k=["wx-resizer",`wx-resizer-${n}`,`wx-resizer-display-${C}`,N?"wx-resizer-active":""].filter(Boolean).join(" ");return l.jsxs("div",{className:"wx-pFykzMlT "+k,onMouseDown:Y,style:{width:a.size[0],height:a.size[1],cursor:B},children:[l.jsxs("div",{className:"wx-pFykzMlT wx-button-expand-box",children:[l.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-left",children:l.jsx("i",{className:"wx-pFykzMlT wxi-menu-left",onClick:Q})}),l.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-right",children:l.jsx("i",{className:"wx-pFykzMlT wxi-menu-right",onClick:j})})]}),l.jsx("div",{className:"wx-pFykzMlT wx-resizer-line"})]})}const at=650;function Ke(s){let r;function o(){r=new ResizeObserver(c=>{for(let M of c)if(M.target===document.body){let m=M.contentRect.width<=at;s(m)}}),r.observe(document.body)}function n(){r&&(r.disconnect(),r=null)}return{observe:o,disconnect:n}}function ut(s){const{taskTemplate:r,readonly:o,cellBorders:n,highlightTime:c,onTableAPIChange:M}=s,m=e.useContext(je),x=p.useStore(m,"_tasks"),g=p.useStore(m,"_scales"),R=p.useStore(m,"cellHeight"),h=p.useStore(m,"columns"),z=p.useStore(m,"_scrollTask"),C=p.useStore(m,"undo"),[u,W]=e.useState(!1);let[N,P]=e.useState(0);const[$,H]=e.useState(0),[I,S]=e.useState(0),[D,d]=e.useState(void 0),[V,O]=e.useState("all"),U=e.useRef(null),B=e.useCallback(v=>{W(ee=>(v!==ee&&(v?(U.current=V,V==="all"&&O("grid")):(!U.current||U.current==="all")&&O("all")),v))},[V]);e.useEffect(()=>{const v=Ke(B);return v.observe(),()=>{v.disconnect()}},[B]);const Y=e.useMemo(()=>{let v;return h.every(ee=>ee.width&&!ee.flexgrow)?v=h.reduce((ee,Z)=>ee+parseInt(Z.width),0):u&&V==="chart"?v=parseInt(h.find(ee=>ee.id==="action")?.width)||50:v=440,N=v,v},[h,u,V]);e.useEffect(()=>{P(Y)},[Y]);const K=e.useMemo(()=>($??0)-(D??0),[$,D]),A=e.useMemo(()=>g.width,[g]),Q=e.useMemo(()=>x.length*R,[x,R]),j=e.useMemo(()=>g.height+Q+K,[g,Q,K]),a=e.useMemo(()=>N+A,[N,A]),k=e.useRef(null),G=e.useCallback(()=>{Promise.resolve().then(()=>{if(($??0)>(a??0)){const v=($??0)-N;m.exec("expand-scale",{minWidth:v})}})},[$,a,N,m]);e.useEffect(()=>{let v;return k.current&&(v=new ResizeObserver(G),v.observe(k.current)),()=>{v&&v.disconnect()}},[k.current,G]),e.useEffect(()=>{G()},[A]);const L=e.useRef(null),q=e.useRef(null),_=e.useCallback(()=>{const v=L.current;v&&m.exec("scroll-chart",{top:v.scrollTop})},[m]),ae=e.useRef({rTasks:[],rScales:{height:0},rCellHeight:0,scrollSize:0,ganttDiv:null,ganttHeight:0});e.useEffect(()=>{ae.current={rTasks:x,rScales:g,rCellHeight:R,scrollSize:K,ganttDiv:L.current,ganttHeight:I??0}},[x,g,R,K,I]);const ue=e.useCallback(v=>{if(!v)return;const{rTasks:ee,rScales:Z,rCellHeight:ne,scrollSize:ke,ganttDiv:be,ganttHeight:ve}=ae.current;if(!be)return;const{id:xe}=v,pe=ee.findIndex(ye=>ye.id===xe);if(pe>-1){const ye=ve-Z.height,oe=pe*ne,me=be.scrollTop;let fe=null;oe<me?fe=oe:oe+ne>me+ye&&(fe=oe-ye+ne+ke),fe!==null&&(m.exec("scroll-chart",{top:Math.max(fe,0)}),L.current.scrollTop=Math.max(fe,0))}},[m]);e.useEffect(()=>{ue(z)},[z]),e.useEffect(()=>{const v=L.current,ee=q.current;if(!v||!ee)return;const Z=()=>{Xe.flushSync(()=>{S(v.offsetHeight),H(v.offsetWidth),d(ee.offsetWidth)})},ne=new ResizeObserver(Z);return ne.observe(v),()=>ne.disconnect()},[L.current]);const de=e.useRef(null),re=e.useRef(null);return e.useEffect(()=>{re.current&&(re.current.destroy(),re.current=null);const v=de.current;if(v)return re.current=Fe.hotkeys(v,{keys:{"ctrl+c":!0,"ctrl+v":!0,"ctrl+x":!0,"ctrl+d":!0,backspace:!0,"ctrl+z":C,"ctrl+y":C},exec:ee=>{ee.isInput||m.exec("hotkey",ee)}}),()=>{re.current?.destroy(),re.current=null}},[C]),l.jsx("div",{className:"wx-jlbQoHOz wx-gantt",ref:L,onScroll:_,children:l.jsx("div",{className:"wx-jlbQoHOz wx-pseudo-rows",style:{height:j,width:"100%"},ref:q,children:l.jsx("div",{className:"wx-jlbQoHOz wx-stuck",style:{height:I,width:D},children:l.jsxs("div",{tabIndex:0,className:"wx-jlbQoHOz wx-layout",ref:de,children:[h.length?l.jsxs(l.Fragment,{children:[l.jsx(Je,{display:V,compactMode:u,columnWidth:Y,width:N,readonly:o,fullHeight:Q,onTableAPIChange:M}),l.jsx(it,{value:N,display:V,compactMode:u,containerWidth:$,onMove:v=>P(v),onDisplayChange:v=>O(v)})]}):null,l.jsx("div",{className:"wx-jlbQoHOz wx-content",ref:k,children:l.jsx(ct,{readonly:o,fullWidth:A,fullHeight:Q,taskTemplate:r,cellBorders:n,highlightTime:c})})]})})})})}function dt(s){return{year:"%Y",quarter:`${s("Q")} %Q`,month:"%M",week:`${s("Week")} %w`,day:"%M %j",hour:"%H:%i"}}function ft(s,r){return typeof s=="function"?s:ie.dateToString(s,r)}function qe(s,r){return s.map(({format:o,...n})=>({...n,format:ft(o,r)}))}function xt(s,r){const o=dt(r);for(let n in o)o[n]=ie.dateToString(o[n],s);return o}function mt(s,r){if(!s||!s.length)return s;const o=ie.dateToString("%d-%m-%Y",r);return s.map(n=>n.template?n:n.id==="start"||n.id=="end"?{...n,_template:c=>o(c),template:c=>o(c)}:n.id==="duration"?{...n,_template:c=>c,template:c=>c}:n)}function ht(s,r){return s.levels?{...s,levels:s.levels.map(o=>({...o,scales:qe(o.scales,r)}))}:s}const gt=s=>s.split("-").map(r=>r?r.charAt(0).toUpperCase()+r.slice(1):"").join(""),wt=[{unit:"month",step:1,format:"%F %Y"},{unit:"day",step:1,format:"%j"}],pt=e.forwardRef(function({taskTemplate:r=null,markers:o=[],taskTypes:n=te.defaultTaskTypes,tasks:c=[],selected:M=[],activeTask:m=null,links:x=[],scales:g=wt,columns:R=te.defaultColumns,start:h=null,end:z=null,lengthUnit:C="day",durationUnit:u="day",cellWidth:W=100,cellHeight:N=38,scaleHeight:P=36,readonly:$=!1,cellBorders:H="full",zoom:I=!1,baselines:S=!1,highlightTime:D=null,init:d=null,autoScale:V=!0,unscheduledTasks:O=!1,criticalPath:U=null,schedule:B={type:"forward"},projectStart:Y=null,projectEnd:K=null,calendar:A=null,undo:Q=!1,splitTasks:j=!1,summary:a=null,_export:k=!1,...G},L){const q=e.useRef();q.current=G;const _=e.useMemo(()=>new te.DataStore(p.writable),[]),ae=e.useMemo(()=>({...Ge.en,...Ie.en}),[]),ue=e.useContext(se.context.i18n),de=e.useMemo(()=>ue?ue.extend(ae,!0):ie.locale(ae),[ue,ae]),re=e.useMemo(()=>de.getRaw().calendar,[de]),v=e.useMemo(()=>{let oe={zoom:ht(I,re),scales:qe(g,re),columns:mt(R,re),links:te.normalizeLinks(x),cellWidth:W};return oe.zoom&&(oe={...oe,...te.normalizeZoom(oe.zoom,xt(re,de.getGroup("gantt")),oe.scales,W)}),oe},[I,g,R,x,W,re,de]),ee=e.useRef(null);ee.current!==c&&(k||te.parseTaskDates(c,{durationUnit:u,splitTasks:j,calendar:A}),ee.current=c),e.useEffect(()=>{k||te.parseTaskDates(c,{durationUnit:u,splitTasks:j,calendar:A})},[c,u,A,j,k]);const Z=e.useMemo(()=>_.in,[_]),ne=e.useRef(null);ne.current===null&&(ne.current=new Be.EventBusRouter((oe,me)=>{const fe="on"+gt(oe);q.current&&q.current[fe]&&q.current[fe](me)}),Z.setNext(ne.current));const[ke,be]=e.useState(null),ve=e.useRef(null);ve.current=ke;const xe=e.useMemo(()=>({getState:_.getState.bind(_),getReactiveState:_.getReactive.bind(_),getStores:()=>({data:_}),exec:Z.exec,setNext:oe=>(ne.current=ne.current.setNext(oe),ne.current),intercept:Z.intercept.bind(Z),on:Z.on.bind(Z),detach:Z.detach.bind(Z),getTask:_.getTask.bind(_),serialize:()=>_.serialize(),getTable:oe=>oe?new Promise(me=>setTimeout(()=>me(ve.current),1)):ve.current,getHistory:()=>_.getHistory()}),[_,Z]);e.useImperativeHandle(L,()=>({...xe}),[xe]);const pe=e.useRef(0);e.useEffect(()=>{pe.current?_.init({tasks:c,links:v.links,start:h,columns:v.columns,end:z,lengthUnit:C,cellWidth:v.cellWidth,cellHeight:N,scaleHeight:P,scales:v.scales,taskTypes:n,zoom:v.zoom,selected:M,activeTask:m,baselines:S,autoScale:V,unscheduledTasks:O,markers:o,durationUnit:u,criticalPath:U,schedule:B,projectStart:Y,projectEnd:K,calendar:A,undo:Q,_weekStart:re.weekStart,splitTasks:j,summary:a}):d&&d(xe),pe.current++},[xe,d,c,v,h,z,C,N,P,n,M,m,S,V,O,o,u,U,B,Y,K,A,Q,re,j,a,_]),pe.current===0&&_.init({tasks:c,links:v.links,start:h,columns:v.columns,end:z,lengthUnit:C,cellWidth:v.cellWidth,cellHeight:N,scaleHeight:P,scales:v.scales,taskTypes:n,zoom:v.zoom,selected:M,activeTask:m,baselines:S,autoScale:V,unscheduledTasks:O,markers:o,durationUnit:u,criticalPath:U,schedule:B,projectStart:Y,projectEnd:K,calendar:A,undo:Q,_weekStart:re.weekStart,splitTasks:j,summary:a});const ye=e.useMemo(()=>A?(oe,me)=>me=="day"&&!A.getDayHours(oe)||me=="hour"&&!A.getDayHours(oe)?"wx-weekend":"":D,[A,D]);return l.jsx(se.context.i18n.Provider,{value:de,children:l.jsx(je.Provider,{value:xe,children:l.jsx(ut,{taskTemplate:r,readonly:$,cellBorders:H,highlightTime:ye,onTableAPIChange:be})})})});function bt({api:s=null,items:r=[]}){const o=e.useContext(se.context.i18n),n=e.useMemo(()=>o||ie.locale(Ie.en),[o]),c=e.useMemo(()=>n.getGroup("gantt"),[n]),M=p.useStoreLater(s,"_selected"),m=p.useStoreLater(s,"undo"),x=p.useStoreLater(s,"history"),g=p.useStoreLater(s,"splitTasks"),R=["undo","redo"],h=e.useMemo(()=>{const C=te.getToolbarButtons({undo:!0,splitTasks:!0});return(r.length?r:te.getToolbarButtons({undo:m,splitTasks:g})).map(W=>{let N={...W,disabled:!1};return N.handler=te.isHandledAction(C,N.id)?P=>te.handleAction(s,P.id,null,c):N.handler,N.text&&(N.text=c(N.text)),N.menuText&&(N.menuText=c(N.menuText)),N})},[r,s,c,m,g]),z=e.useMemo(()=>{const C=[];return h.forEach(u=>{const W=u.id;if(W==="add-task")C.push(u);else if(R.includes(W))R.includes(W)&&C.push({...u,disabled:u.isDisabled(x)});else{if(!M?.length||!s)return;C.push({...u,disabled:u.isDisabled&&M.some(N=>u.isDisabled(N,s.getState()))})}}),C.filter((u,W)=>{if(s&&u.isHidden)return!M.some(N=>u.isHidden(N,s.getState()));if(u.comp==="separator"){const N=C[W+1];if(!N||N.comp==="separator")return!1}return!0})},[s,M,x,h]);return o?l.jsx(Pe.Toolbar,{items:z}):l.jsx(se.context.i18n.Provider,{value:n,children:l.jsx(Pe.Toolbar,{items:z})})}const kt=e.forwardRef(function({options:r=[],api:o=null,resolver:n=null,filter:c=null,at:M="point",children:m,onClick:x,css:g},R){const h=e.useRef(null),z=e.useRef(null),C=e.useContext(se.context.i18n),u=e.useMemo(()=>C||ie.locale({...Ie.en,...Ge.en}),[C]),W=e.useMemo(()=>u.getGroup("gantt"),[u]),N=p.useStoreLater(o,"taskTypes"),P=p.useStoreLater(o,"selected"),$=p.useStoreLater(o,"_selected"),H=p.useStoreLater(o,"splitTasks"),I=p.useStoreLater(o,"summary"),S=e.useMemo(()=>({splitTasks:H,taskTypes:N,summary:I}),[H,N,I]),D=e.useMemo(()=>te.getMenuOptions(S),[S]);e.useEffect(()=>{o&&(o.on("scroll-chart",()=>{h.current&&h.current.show&&h.current.show()}),o.on("drag-task",()=>{h.current&&h.current.show&&h.current.show()}))},[o]);function d(j){return j.map(a=>(a={...a},a.text&&(a.text=W(a.text)),a.subtext&&(a.subtext=W(a.subtext)),a.data&&(a.data=d(a.data)),a))}function V(){const j=r.length?r:te.getMenuOptions(S);return d(j)}const O=e.useMemo(()=>V(),[o,r,S,W]),U=e.useMemo(()=>$&&$.length?$:[],[$]),B=e.useCallback((j,a)=>{let k=j?o?.getTask(j):null;if(n){const G=n(j,a);k=G===!0?k:G}if(k){const G=ie.locateID(a.target,"data-segment");G!==null?z.current={id:k.id,segmentIndex:G}:z.current=k.id,(!Array.isArray(P)||!P.includes(k.id))&&o&&o.exec&&o.exec("select-task",{id:k.id})}return k},[o,n,P]),Y=e.useCallback(j=>{const a=j.action;a&&(te.isHandledAction(D,a.id)&&te.handleAction(o,a.id,z.current,W),x&&x(j))},[o,W,x,D]),K=e.useCallback((j,a)=>{const k=U.length?U:a?[a]:[];let G=c?k.every(L=>c(j,L)):!0;if(G&&(j.isHidden&&(G=!k.some(L=>j.isHidden(L,o.getState(),z.current))),j.isDisabled)){const L=k.some(q=>j.isDisabled(q,o.getState(),z.current));j.disabled=L}return G},[c,U,o]);e.useImperativeHandle(R,()=>({show:(j,a)=>{h.current&&h.current.show&&h.current.show(j,a)}}));const A=e.useCallback(j=>{h.current&&h.current.show&&h.current.show(j)},[]),Q=l.jsxs(l.Fragment,{children:[l.jsx(Ye.ContextMenu,{filter:K,options:O,dataKey:"id",resolver:B,onClick:Y,at:M,ref:h,css:g}),l.jsx("span",{onContextMenu:A,"data-menu-ignore":"true",children:typeof m=="function"?m():m})]});if(!C&&se.context.i18n?.Provider){const j=se.context.i18n.Provider;return l.jsx(j,{value:u,children:Q})}return Q});function yt({api:s,autoSave:r,onLinksChange:o}){const c=e.useContext(se.context.i18n).getGroup("gantt"),M=p.useStore(s,"activeTask"),m=p.useStore(s,"_activeTask"),x=p.useStore(s,"_links"),g=p.useStore(s,"schedule"),R=p.useStore(s,"unscheduledTasks"),[h,z]=e.useState();function C(){if(M){const P=x.filter(H=>H.target==M).map(H=>({link:H,task:s.getTask(H.source)})),$=x.filter(H=>H.source==M).map(H=>({link:H,task:s.getTask(H.target)}));return[{title:c("Predecessors"),data:P},{title:c("Successors"),data:$}]}}e.useEffect(()=>{z(C())},[M,x]);const u=e.useMemo(()=>[{id:"e2s",label:c("End-to-start")},{id:"s2s",label:c("Start-to-start")},{id:"e2e",label:c("End-to-end")},{id:"s2e",label:c("Start-to-end")}],[c]);function W(P){r?s.exec("delete-link",{id:P}):(z($=>($||[]).map(H=>({...H,data:H.data.filter(I=>I.link.id!==P)}))),o&&o({id:P,action:"delete-link",data:{id:P}}))}function N(P,$){r?s.exec("update-link",{id:P,link:$}):(z(H=>(H||[]).map(I=>({...I,data:I.data.map(S=>S.link.id===P?{...S,link:{...S.link,...$}}:S)}))),o&&o({id:P,action:"update-link",data:{id:P,link:$}}))}return l.jsx(l.Fragment,{children:(h||[]).map((P,$)=>P.data.length?l.jsx("div",{className:"wx-j93aYGQf wx-links",children:l.jsx(se.context.fieldId.Provider,{value:null,children:l.jsx(se.Field,{label:P.title,position:"top",children:l.jsx("table",{children:l.jsx("tbody",{children:P.data.map(H=>l.jsxs("tr",{children:[l.jsx("td",{className:"wx-j93aYGQf wx-cell",children:l.jsx("div",{className:"wx-j93aYGQf wx-task-name",children:H.task.text||""})}),g?.auto&&H.link.type==="e2s"?l.jsx("td",{className:"wx-j93aYGQf wx-cell wx-link-lag",children:l.jsx(se.Text,{type:"number",placeholder:c("Lag"),value:H.link.lag,disabled:R&&m?.unscheduled,onChange:I=>{I.input||N(H.link.id,{lag:I.value})}})}):null,l.jsx("td",{className:"wx-j93aYGQf wx-cell",children:l.jsx("div",{className:"wx-j93aYGQf wx-wrapper",children:l.jsx(se.Combo,{value:H.link.type,placeholder:c("Select link type"),options:u,onChange:I=>N(H.link.id,{type:I.value}),children:({option:I})=>I.label})})}),l.jsx("td",{className:"wx-j93aYGQf wx-cell",children:l.jsx("i",{className:"wx-j93aYGQf wxi-delete wx-delete-icon",onClick:()=>W(H.link.id),role:"button"})})]},H.link.id))})})})})},$):null)})}function vt(s){const{value:r,time:o,format:n,onchange:c,onChange:M,...m}=s,x=M??c;function g(R){const h=new Date(R.value);h.setHours(r.getHours()),h.setMinutes(r.getMinutes()),x&&x({value:h})}return l.jsxs("div",{className:"wx-hFsbgDln date-time-controll",children:[l.jsx(se.DatePicker,{...m,value:r,onChange:g,format:n,buttons:["today"],clear:!1}),o?l.jsx(se.TimePicker,{value:r,onChange:x,format:n}):null]})}Me.registerEditorItem("select",se.RichSelect);Me.registerEditorItem("date",vt);Me.registerEditorItem("twostate",se.TwoState);Me.registerEditorItem("slider",se.Slider);Me.registerEditorItem("counter",se.Counter);Me.registerEditorItem("links",yt);function Ct({api:s,items:r=[],css:o="",layout:n="default",readonly:c=!1,placement:M="sidebar",bottomBar:m=!0,topBar:x=!0,autoSave:g=!0,focus:R=!1,hotkeys:h={}}){const z=e.useContext(se.context.i18n),C=e.useMemo(()=>z||ie.locale({...Ie.en,...Ge.en}),[z]),u=e.useMemo(()=>C.getGroup("gantt"),[C]),W=C.getRaw(),N=e.useMemo(()=>{const b=W.gantt?.dateFormat||W.formats?.dateFormat;return ie.dateToString(b,W.calendar)},[W]),P=e.useMemo(()=>{if(x===!0&&!c){const b=[{comp:"icon",icon:"wxi-close",id:"close"},{comp:"spacer"},{comp:"button",type:"danger",text:u("Delete"),id:"delete"}];return g?{items:b}:{items:[...b,{comp:"button",type:"primary",text:u("Save"),id:"save"}]}}return x},[x,c,g,u]),[$,H]=e.useState(!1),I=e.useMemo(()=>$?"wx-full-screen":"",[$]),S=e.useCallback(b=>{H(b)},[]);e.useEffect(()=>{const b=Ke(S);return b.observe(),()=>{b.disconnect()}},[S]);const D=p.useStore(s,"_activeTask"),d=p.useStore(s,"activeTask"),V=p.useStore(s,"unscheduledTasks"),O=p.useStore(s,"summary"),U=p.useStore(s,"links"),B=p.useStore(s,"splitTasks"),Y=e.useMemo(()=>B&&d?.segmentIndex,[B,d]),K=e.useMemo(()=>Y||Y===0,[Y]),A=p.useStore(s,"taskTypes"),Q=e.useMemo(()=>te.getEditorItems({unscheduledTasks:V,summary:O,taskTypes:A}),[V,O,A]),j=p.useStore(s,"undo"),[a,k]=e.useState({}),[G,L]=e.useState(null),[q,_]=e.useState(),[ae,ue]=e.useState(null),de=e.useMemo(()=>{if(!D)return null;let b;if(K&&D.segments?b={...D.segments[Y]}:b={...D},c){let J={parent:b.parent};return Q.forEach(({key:le,comp:F})=>{if(F!=="links"){const ce=b[le];F==="date"&&ce instanceof Date?J[le]=N(ce):F==="slider"&&le==="progress"?J[le]=`${ce}%`:J[le]=ce}}),J}return b||null},[D,K,Y,c,Q,N]);e.useEffect(()=>{_(de)},[de]),e.useEffect(()=>{k({}),ue(null),L(null)},[d]);function re(b,J){return b.map(le=>{const F={...le};if(le.config&&(F.config={...F.config}),F.comp==="links"&&s&&(F.api=s,F.autoSave=g,F.onLinksChange=Z),F.comp==="select"&&F.key==="type"){const ce=F.options??[];F.options=ce.map(Te=>({...Te,label:u(Te.label)}))}return F.comp==="slider"&&F.key==="progress"&&(F.labelTemplate=ce=>`${u(F.label)} ${ce}%`),F.label&&(F.label=u(F.label)),F.config?.placeholder&&(F.config.placeholder=u(F.config.placeholder)),J&&(F.isDisabled&&F.isDisabled(J,s.getState())?F.disabled=!0:delete F.disabled),F})}const v=e.useMemo(()=>{let b=r.length?r:Q;return b=re(b,q),q?b.filter(J=>!J.isHidden||!J.isHidden(q,s.getState())):b},[r,Q,q,u,s,g]),ee=e.useMemo(()=>v.map(b=>b.key),[v]);function Z({id:b,action:J,data:le}){k(F=>({...F,[b]:{action:J,data:le}}))}const ne=e.useCallback(()=>{for(let b in a)if(U.byId(b)){const{action:J,data:le}=a[b];s.exec(J,le)}},[s,a,U]),ke=e.useCallback(()=>{const b=d?.id||d;if(K){if(D?.segments){const J=D.segments.filter((le,F)=>F!==Y);s.exec("update-task",{id:b,task:{segments:J}})}}else s.exec("delete-task",{id:b})},[s,d,K,D,Y]),be=e.useCallback(()=>{s.exec("show-editor",{id:null})},[s]),ve=e.useCallback(b=>{const{item:J,changes:le}=b;J.id==="delete"&&ke(),J.id==="save"&&(le.length?be():ne()),J.comp&&be()},[s,d,g,ne,ke,be]),xe=e.useCallback((b,J,le)=>(V&&b.type==="summary"&&(b.unscheduled=!1),te.prepareEditTask(b,s.getState(),J),le||L(!1),b),[V,s]),pe=e.useCallback(b=>{b={...b,unscheduled:V&&b.unscheduled&&b.type!=="summary"},delete b.links,delete b.data,(ee.indexOf("duration")===-1||b.segments&&!b.duration)&&delete b.duration;const J={id:d?.id||d,task:b,...K&&{segmentIndex:Y}};g&&G&&(J.inProgress=G),s.exec("update-task",J),g||ne()},[s,d,V,g,ne,ee,K,Y,G]),ye=e.useCallback(b=>{let{update:J,key:le,input:F}=b;if(F&&L(!0),b.update=xe({...J},le,F),!g)_(b.update);else if(!ae&&!F){const ce=v.find(i=>i.key===le),Te=J[le];(!ce.validation||ce.validation(Te))&&(!ce.required||Te)&&pe(b.update)}},[g,xe,ae,v,pe]),oe=e.useCallback(b=>{g||pe(b.values)},[g,pe]),me=e.useCallback(b=>{ue(b.errors)},[]),fe=e.useMemo(()=>j?{"ctrl+z":b=>{b.preventDefault(),s.exec("undo")},"ctrl+y":b=>{b.preventDefault(),s.exec("redo")}}:{},[j,s]);return de?l.jsx(se.Locale,{children:l.jsx(Me.Editor,{css:`wx-XkvqDXuw wx-gantt-editor ${I} ${o}`,items:v,values:de,topBar:P,bottomBar:m,placement:M,layout:n,readonly:c,autoSave:g,focus:R,onAction:ve,onSave:oe,onValidation:me,onChange:ye,hotkeys:h&&{...fe,...h}})}):null}const St=({children:s,columns:r=null,api:o})=>{const[n,c]=e.useState(null);return e.useEffect(()=>{o&&o.getTable(!0).then(c)},[o]),l.jsx(Ve.HeaderMenu,{api:n,columns:r,children:s})};function Tt(s){const{api:r,content:o,children:n}=s,c=e.useRef(null),M=e.useRef(null),[m,x]=e.useState({}),[g,R]=e.useState(null),[h,z]=e.useState({});function C(S){for(;S;){if(S.getAttribute){const D=S.getAttribute("data-tooltip-id"),d=S.getAttribute("data-tooltip-at"),V=S.getAttribute("data-tooltip");if(D||V)return{id:D,tooltip:V,target:S,at:d}}S=S.parentNode}return{id:null,tooltip:null,target:null,at:null}}e.useEffect(()=>{const S=M.current;if(S&&h&&(h.text||o)){const D=S.getBoundingClientRect();let d=!1,V=h.left,O=h.top;D.right>=m.right&&(V=m.width-D.width-5,d=!0),D.bottom>=m.bottom&&(O=h.top-(D.bottom-m.bottom+2),d=!0),d&&z(U=>U&&{...U,left:V,top:O})}},[h,m,o]);const u=e.useRef(null),W=300,N=S=>{clearTimeout(u.current),u.current=setTimeout(()=>{S()},W)};function P(S){let{id:D,tooltip:d,target:V,at:O}=C(S.target);if(z(null),R(null),!d)if(D)d=H(D);else{clearTimeout(u.current);return}const U=S.clientX;N(()=>{D&&R($(I(D)));const B=V.getBoundingClientRect(),Y=c.current,K=Y?Y.getBoundingClientRect():{top:0,left:0,right:0,bottom:0,width:0,height:0};let A,Q;O==="left"?(A=B.top+5-K.top,Q=B.right+5-K.left):(A=B.top+B.height-K.top,Q=U-K.left),x(K),z({top:A,left:Q,text:d})})}function $(S){return r?.getTask(I(S))||null}function H(S){return $(S)?.text||""}function I(S){const D=parseInt(S);return isNaN(D)?S:D}return l.jsxs("div",{className:"wx-KG0Lwsqo wx-tooltip-area",ref:c,onMouseMove:P,children:[h&&(h.text||o)?l.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip",ref:M,style:{top:`${h.top}px`,left:`${h.left}px`},children:o?l.jsx(o,{data:g}):h.text?l.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip-text",children:h.text}):null}):null,n]})}function Mt({fonts:s=!0,children:r}){return r?l.jsx(se.Material,{fonts:s,children:r()}):l.jsx(se.Material,{fonts:s})}function jt({fonts:s=!0,children:r}){return r?l.jsx(se.Willow,{fonts:s,children:r}):l.jsx(se.Willow,{fonts:s})}function Et({fonts:s=!0,children:r}){return r?l.jsx(se.WillowDark,{fonts:s,children:r}):l.jsx(se.WillowDark,{fonts:s})}const Rt="2.5.2",Nt={version:Rt},$t=Nt.version;Object.defineProperty(exports,"defaultColumns",{enumerable:!0,get:()=>te.defaultColumns});Object.defineProperty(exports,"defaultEditorItems",{enumerable:!0,get:()=>te.defaultEditorItems});Object.defineProperty(exports,"defaultMenuOptions",{enumerable:!0,get:()=>te.defaultMenuOptions});Object.defineProperty(exports,"defaultTaskTypes",{enumerable:!0,get:()=>te.defaultTaskTypes});Object.defineProperty(exports,"defaultToolbarButtons",{enumerable:!0,get:()=>te.defaultToolbarButtons});Object.defineProperty(exports,"getEditorItems",{enumerable:!0,get:()=>te.getEditorItems});Object.defineProperty(exports,"getMenuOptions",{enumerable:!0,get:()=>te.getMenuOptions});Object.defineProperty(exports,"getToolbarButtons",{enumerable:!0,get:()=>te.getToolbarButtons});Object.defineProperty(exports,"registerScaleUnit",{enumerable:!0,get:()=>te.registerScaleUnit});Object.defineProperty(exports,"registerEditorItem",{enumerable:!0,get:()=>Me.registerEditorItem});exports.ContextMenu=kt;exports.Editor=Ct;exports.Gantt=pt;exports.HeaderMenu=St;exports.Material=Mt;exports.Toolbar=bt;exports.Tooltip=Tt;exports.Willow=jt;exports.WillowDark=Et;exports.version=$t;
//# sourceMappingURL=index.cjs.map

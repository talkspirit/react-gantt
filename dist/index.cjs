"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const l=require("react/jsx-runtime"),e=require("react"),le=require("@svar-ui/react-core"),de=require("@svar-ui/lib-dom"),Ie=require("@svar-ui/gantt-locales"),He=require("@svar-ui/core-locales"),Be=require("@svar-ui/lib-state"),re=require("@svar-ui/gantt-store"),b=require("@svar-ui/lib-react"),Fe=require("@svar-ui/grid-store"),Ve=require("@svar-ui/react-grid"),Xe=require("react-dom"),Ge=require("@svar-ui/react-toolbar"),Ye=require("@svar-ui/react-menu"),je=require("@svar-ui/react-editor"),Me=e.createContext(null);function $e(s){const n=s.getAttribute("data-id"),o=parseInt(n);return isNaN(o)||o.toString()!=n?n:o}function Qe(s,n,o){const r=s.getBoundingClientRect(),c=n.querySelector(".wx-body").getBoundingClientRect();return{top:r.top-c.top,left:r.left-c.left,dt:r.bottom-o.clientY,db:o.clientY-r.top}}function Pe(s){return s&&s.getAttribute("data-context-id")}const Oe=5;function Ue(s,n){let o,r,c,j,m,x,g,R,h;function G(d){j=d.clientX,m=d.clientY,x={...Qe(o,s,d),y:n.getTask(c).$y},document.body.style.userSelect="none"}function C(d){o=de.locate(d),Pe(o)&&(c=$e(o),h=setTimeout(()=>{R=!0,n&&n.touchStart&&n.touchStart(),G(d.touches[0])},500),s.addEventListener("touchmove",H),s.addEventListener("contextmenu",u),window.addEventListener("touchend",I))}function u(d){if(R||h)return d.preventDefault(),!1}function O(d){d.which===1&&(o=de.locate(d),Pe(o)&&(c=$e(o),s.addEventListener("mousemove",$),window.addEventListener("mouseup",S),G(d)))}function N(d){s.removeEventListener("mousemove",$),s.removeEventListener("touchmove",H),document.body.removeEventListener("mouseup",S),document.body.removeEventListener("touchend",I),document.body.style.userSelect="",d&&(s.removeEventListener("mousedown",O),s.removeEventListener("touchstart",C))}function P(d){const V=d.clientX-j,_=d.clientY-m;if(!r){if(Math.abs(V)<Oe&&Math.abs(_)<Oe||n&&n.start&&n.start({id:c,e:d})===!1)return;r=o.cloneNode(!0),r.style.pointerEvents="none",r.classList.add("wx-reorder-task"),r.style.position="absolute",r.style.left=x.left+"px",r.style.top=x.top+"px",o.style.visibility="hidden",o.parentNode.insertBefore(r,o)}if(r){const Z=Math.round(Math.max(0,x.top+_));if(n&&n.move&&n.move({id:c,top:Z,detail:g})===!1)return;const B=n.getTask(c),Q=B.$y;if(!x.start&&x.y==Q)return D();x.start=!0,x.y=B.$y-4,r.style.top=Z+"px";const K=document.elementFromPoint(d.clientX,d.clientY),A=de.locate(K);if(A&&A!==o){const U=$e(A),E=A.getBoundingClientRect(),a=E.top+E.height/2,k=d.clientY+x.db>a&&A.nextElementSibling!==o,W=d.clientY-x.dt<a&&A.previousElementSibling!==o;g?.after==U||g?.before==U?g=null:k?g={id:c,after:U}:W&&(g={id:c,before:U})}}}function $(d){P(d)}function H(d){R?(d.preventDefault(),P(d.touches[0])):h&&(clearTimeout(h),h=null)}function I(){R=null,h&&(clearTimeout(h),h=null),D()}function S(){D()}function D(){o&&(o.style.visibility=""),r&&(r.parentNode.removeChild(r),n&&n.end&&n.end({id:c,top:x.top})),c=o=r=x=g=null,N()}return s.style.position!=="absolute"&&(s.style.position="relative"),s.addEventListener("mousedown",O),s.addEventListener("touchstart",C),{destroy(){N(!0)}}}function Ze({row:s,column:n}){const o=e.useContext(Me);function r(j,m){return{justifyContent:m.align,paddingLeft:`${(j.$level-1)*20}px`}}const c=n&&n._cell;return l.jsxs("div",{className:"wx-pqc08MHU wx-content",style:r(s,n),children:[s.data||s.lazy?l.jsx("i",{className:`wx-pqc08MHU wx-toggle-icon wxi-menu-${s.open?"down":"right"}`,"data-action":"open-task"}):l.jsx("i",{className:"wx-pqc08MHU wx-toggle-placeholder"}),l.jsx("div",{className:"wx-pqc08MHU wx-text",children:c?l.jsx(c,{row:s,column:n,api:o}):s.text})]})}function _e({column:s,cell:n}){const o=e.useMemo(()=>s.id,[s?.id]);return n||s.id=="add-task"?l.jsx("div",{style:{textAlign:s.align},children:l.jsx("i",{className:"wx-9DAESAHW wx-action-icon wxi-plus","data-action":o})}):null}function Je(s){const{readonly:n,compactMode:o,width:r=0,display:c="all",columnWidth:j=0,onTableAPIChange:m}=s,[x,g]=b.useWritableProp(j),[R,h]=e.useState(),G=e.useContext(le.context.i18n),C=e.useMemo(()=>G.getGroup("gantt"),[G]),u=e.useContext(Me),O=b.useStore(u,"scrollTop"),N=b.useStore(u,"cellHeight"),P=b.useStore(u,"_scrollTask"),$=b.useStore(u,"_selected"),H=b.useStore(u,"area"),I=b.useStore(u,"_tasks"),S=b.useStore(u,"_scales"),D=b.useStore(u,"columns"),d=b.useStore(u,"_sort"),V=b.useStore(u,"calendar"),_=b.useStore(u,"durationUnit"),Z=b.useStore(u,"splitTasks"),[B,Q]=e.useState(null),K=e.useMemo(()=>!I||!H?[]:I.slice(H.start,H.end),[I,H]),A=e.useCallback((i,p)=>{if(p==="add-task")u.exec(p,{target:i,task:{text:C("New Task")},mode:"child",show:!0});else if(p==="open-task"){const T=K.find(t=>t.id===i);(T?.data||T?.lazy)&&u.exec(p,{id:i,mode:!T.open})}},[K]),U=e.useCallback(i=>{const p=de.locateID(i),T=i.target.dataset.action;T&&i.preventDefault(),p?T==="add-task"||T==="open-task"?A(p,T):u.exec("select-task",{id:p,toggle:i.ctrlKey||i.metaKey,range:i.shiftKey,show:!0}):T==="add-task"&&A(null,T)},[u,A]),E=e.useRef(null),a=e.useRef(null),[k,W]=e.useState(0),[L,q]=e.useState(!1);e.useEffect(()=>{const i=a.current;if(!i||typeof ResizeObserver>"u")return;const p=()=>W(i.clientWidth);p();const T=new ResizeObserver(p);return T.observe(i),()=>T.disconnect()},[]);const F=e.useRef(null),fe=e.useCallback(i=>{const p=i.id,{before:T,after:t}=i,f=i.onMove;let y=T||t,M=T?"before":"after";if(f){if(M==="after"){const Y=u.getTask(y);Y.data?.length&&Y.open&&(M="before",y=Y.data[0].id)}F.current={id:p,[M]:y}}else F.current=null;u.exec("move-task",{id:p,mode:M,target:y,inProgress:f})},[u]),xe=e.useMemo(()=>H?.from??0,[H]),me=e.useMemo(()=>S?.height??0,[S]),ue=e.useMemo(()=>!o&&c!=="grid"?(x??0)>(r??0):(x??0)>(k??0),[o,c,x,r,k]),v=e.useMemo(()=>{const i={};return ue&&c==="all"||c==="grid"&&ue?i.width=x:c==="grid"&&(i.width="100%"),i},[ue,c,x]),ee=e.useMemo(()=>B&&!K.find(i=>i.id===B.id)?[...K,B]:K,[K,B]),J=e.useMemo(()=>{let i=(D||[]).map(t=>{t={...t};const f=t.header;if(typeof f=="object"){const y=f.text&&C(f.text);t.header={...f,text:y}}else t.header=C(f);if(t.cell&&t.id!=="text"&&t.id!=="add-task"){const y=t.cell;t.cell=M=>l.jsx(y,{...M,api:u})}return t});const p=i.findIndex(t=>t.id==="text"),T=i.findIndex(t=>t.id==="add-task");if(p!==-1&&(i[p].cell&&(i[p]._cell=i[p].cell),i[p].cell=Ze),T!==-1){i[T].cell=i[T].cell||_e;const t=i[T].header;if(typeof t!="object"&&(i[T].header={text:t}),i[T].header.cell=t.cell||_e,n)i.splice(T,1);else if(o){const[f]=i.splice(T,1);i.unshift(f)}}return i.length>0&&(i[i.length-1].resize=!1),i},[D,C,n,o,u]),ce=e.useMemo(()=>c==="all"?`${r}px`:c==="grid"?"calc(100% - 4px)":J.find(i=>i.id==="add-task")?"50px":"0",[c,r,J]),ke=e.useMemo(()=>{if(ee&&d?.length){const i={};return d.forEach(({key:p,order:T},t)=>{i[p]={order:T,...d.length>1&&{index:t}}}),i}return{}},[ee,d]),be=e.useCallback(()=>J.some(i=>i.flexgrow&&!i.hidden),[]),Ce=e.useMemo(()=>be(),[be,L]),se=e.useMemo(()=>{let i=c==="chart"?J.filter(T=>T.id==="add-task"):J;const p=c==="all"?r:k;if(!Ce){let T=x,t=!1;if(J.some(f=>f.$width)){let f=0;T=J.reduce((y,M)=>(M.hidden||(f+=M.width,y+=M.$width||M.width),y),0),f>T&&T>p&&(t=!0)}if(t||T<p){let f=1;return t||(f=(p-50)/(T-50||1)),i.map(y=>(y.id!=="add-task"&&!y.hidden&&(y.$width||(y.$width=y.width),y.width=y.$width*f),y))}}return i},[c,J,Ce,x,r,k]),pe=e.useCallback(i=>{if(!be()){const p=se.reduce((T,t)=>(i&&t.$width&&(t.$width=t.width),T+(t.hidden?0:t.width)),0);p!==x&&g(p)}q(!0),q(!1)},[be,se,x,g]),ye=e.useCallback(()=>{J.filter(p=>p.flexgrow&&!p.hidden).length===1&&J.forEach(p=>{p.$width&&!p.flexgrow&&!p.hidden&&(p.width=p.$width)})},[]),te=e.useCallback(i=>{if(!n){const p=de.locateID(i),T=de.locateAttr(i,"data-col-id");!(T&&J.find(f=>f.id==T))?.editor&&p&&u.exec("show-editor",{id:p})}},[u,n]),ie=e.useMemo(()=>Array.isArray($)?$.map(i=>i.id):[],[$]),oe=e.useCallback(()=>{if(E.current&&ee!==null){const i=E.current.querySelector(".wx-body");i&&(i.style.top=-((O??0)-(xe??0))+"px")}a.current&&(a.current.scrollTop=0)},[ee,O,xe]);e.useEffect(()=>{E.current&&oe()},[O,xe,oe]),e.useEffect(()=>{const i=E.current;if(!i)return;const p=i.querySelector(".wx-table-box .wx-body");if(!p||typeof ResizeObserver>"u")return;const T=new ResizeObserver(()=>{oe()});return T.observe(p),()=>{T.disconnect()}},[se,v,c,ce,ee,oe]),e.useEffect(()=>{if(!P||!R)return;const{id:i}=P,p=R.getState().focusCell;p&&p.row!==i&&E.current&&E.current.contains(document.activeElement)&&R.exec("focus-cell",{row:i,column:p.column})},[P,R]);const w=e.useCallback(({id:i})=>{if(n)return!1;u.getTask(i).open&&u.exec("open-task",{id:i,mode:!1});const p=u.getState()._tasks.find(T=>T.id===i);if(Q(p||null),!p)return!1},[u,n]),X=e.useCallback(({id:i,top:p})=>{F.current?fe({...F.current,onMove:!1}):u.exec("drag-task",{id:i,top:p+(xe??0),inProgress:!1}),Q(null)},[u,fe,xe]),ae=e.useCallback(({id:i,top:p,detail:T})=>{T&&fe({...T,onMove:!0}),u.exec("drag-task",{id:i,top:p+(xe??0),inProgress:!0})},[u,fe,xe]);e.useEffect(()=>{const i=E.current;return i?Ue(i,{start:w,end:X,move:ae,getTask:u.getTask}).destroy:void 0},[u,w,X,ae]);const z=e.useCallback(i=>{const{key:p,isInput:T}=i;if(!T&&(p==="arrowup"||p==="arrowdown"))return i.eventSource="grid",u.exec("hotkey",i),!1;if(p==="enter"){const t=R?.getState().focusCell;if(t){const{row:f,column:y}=t;y==="add-task"?A(f,"add-task"):y==="text"&&A(f,"open-task")}}},[u,A,R]),ne=e.useRef(null),ve=()=>{ne.current={setTableAPI:h,handleHotkey:z,sortVal:d,api:u,adjustColumns:ye,setColumnWidth:pe,tasks:K,calendarVal:V,durationUnitVal:_,splitTasksVal:Z,onTableAPIChange:m}};ve(),e.useEffect(()=>{ve()},[h,z,d,u,ye,pe,K,V,_,Z,m]);const Ee=e.useCallback(i=>{h(i),i.intercept("hotkey",p=>ne.current.handleHotkey(p)),i.intercept("scroll",()=>!1),i.intercept("select-row",()=>!1),i.intercept("sort-rows",p=>{const T=ne.current.sortVal,{key:t,add:f}=p,y=T?T.find(Y=>Y.key===t):null;let M="asc";return y&&(M=!y||y.order==="asc"?"desc":"asc"),u.exec("sort-tasks",{key:t,order:M,add:f}),!1}),i.on("resize-column",()=>{ne.current.setColumnWidth(!0)}),i.on("hide-column",p=>{p.mode||ne.current.adjustColumns(),ne.current.setColumnWidth()}),i.intercept("update-cell",p=>{const{id:T,column:t,value:f}=p,y=ne.current.tasks.find(M=>M.id===T);if(y){const M={...y};let Y=f;Y&&!isNaN(Y)&&!(Y instanceof Date)&&(Y*=1),M[t]=Y,re.prepareEditTask(M,{calendar:ne.current.calendarVal,durationUnit:ne.current.durationUnitVal,splitTasks:ne.current.splitTasksVal},t),u.exec("update-task",{id:T,task:M})}return!1}),m&&m(i)},[]);return l.jsx("div",{className:"wx-rHj6070p wx-table-container",style:{flex:`0 0 ${ce}`},ref:a,children:l.jsx("div",{ref:E,style:v,className:"wx-rHj6070p wx-table",onClick:U,onDoubleClick:te,children:l.jsx(Ve.Grid,{init:Ee,sizes:{rowHeight:N,headerHeight:(me??0)-1},rowStyle:i=>i.$reorder?"wx-rHj6070p wx-reorder-task":"wx-rHj6070p",columnStyle:i=>`wx-rHj6070p wx-text-${i.align}${i.id==="add-task"?" wx-action":""}`,data:ee,columns:se,selectedRows:[...ie],sortMarks:ke})})})}function et({borders:s=""}){const n=e.useContext(Me),o=b.useStore(n,"cellWidth"),r=b.useStore(n,"cellHeight"),c=e.useRef(null),[j,m]=e.useState("#e4e4e4");e.useEffect(()=>{if(typeof getComputedStyle<"u"&&c.current){const g=getComputedStyle(c.current).getPropertyValue("--wx-gantt-border");m(g?g.substring(g.indexOf("#")):"#1d1e261a")}},[]);const x={width:"100%",height:"100%",background:o!=null&&r!=null?`url(${re.grid(o,r,j,s)})`:void 0,position:"absolute"};return l.jsx("div",{ref:c,style:x})}function tt({onSelectLink:s,selectedLink:n,readonly:o}){const r=e.useContext(Me),c=b.useStore(r,"_links"),j=b.useStore(r,"criticalPath"),m=e.useRef(null),x=e.useCallback(g=>{const R=g?.target?.classList;!R?.contains("wx-line")&&!R?.contains("wx-delete-button")&&s(null)},[s]);return e.useEffect(()=>{if(!o&&n&&m.current){const g=R=>{m.current&&!m.current.contains(R.target)&&x(R)};return document.addEventListener("click",g),()=>{document.removeEventListener("click",g)}}},[o,n,x]),l.jsxs("svg",{className:"wx-dkx3NwEn wx-links",children:[(c||[]).map(g=>{const R="wx-dkx3NwEn wx-line"+(j&&g.$critical?" wx-critical":"")+(o?"":" wx-line-selectable");return l.jsx("polyline",{className:R,points:g.$p,onClick:()=>!o&&s(g.id),"data-link-id":g.id},g.id)}),!o&&n&&l.jsx("polyline",{ref:m,className:"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link",points:n.$p})]})}function st(s){const{task:n,type:o}=s;function r(j){const m=n.segments[j];return{left:`${m.$x}px`,top:"0px",width:`${m.$w}px`,height:"100%"}}function c(j){if(!n.progress)return 0;const m=n.duration*n.progress/100,x=n.segments;let g=0,R=0,h=null;do{const G=x[R];R===j&&(g>m?h=0:h=Math.min((m-g)/G.duration,1)*100),g+=G.duration,R++}while(h===null&&R<x.length);return h||0}return l.jsx("div",{className:"wx-segments wx-GKbcLEGA",children:n.segments.map((j,m)=>l.jsxs("div",{className:`wx-segment wx-bar wx-${o} wx-GKbcLEGA`,"data-segment":m,style:r(m),children:[n.progress?l.jsx("div",{className:"wx-progress-wrapper",children:l.jsx("div",{className:"wx-progress-percent wx-GKbcLEGA",style:{width:`${c(m)}%`}})}):null,l.jsx("div",{className:"wx-content",children:j.text||""})]},m))})}function nt(s){const{readonly:n,taskTemplate:o}=s,r=e.useContext(Me),[c,j]=b.useStoreWithCounter(r,"_tasks"),[m,x]=b.useStoreWithCounter(r,"_links"),g=b.useStore(r,"area"),R=b.useStore(r,"_scales"),h=b.useStore(r,"taskTypes"),G=b.useStore(r,"baselines"),C=b.useStore(r,"_selected"),u=b.useStore(r,"_scrollTask"),O=b.useStore(r,"criticalPath"),N=b.useStore(r,"tasks"),P=b.useStore(r,"schedule"),$=b.useStore(r,"splitTasks"),H=b.useStore(r,"summary"),I=e.useMemo(()=>{if(!g||!Array.isArray(c))return[];const t=g.start??0,f=g.end??0;return c.slice(t,f).map(y=>({...y}))},[j,g]),S=e.useMemo(()=>R.lengthUnitWidth,[R]),D=e.useRef(!1),[d,V]=e.useState(void 0),[_,Z]=e.useState(null),B=e.useRef(null),[Q,K]=e.useState(null),A=e.useMemo(()=>Q&&{...m.find(t=>t.id===Q)},[Q,x]),[U,E]=e.useState(void 0),a=e.useRef(null),[k,W]=e.useState(0),L=e.useRef(null),q=e.useMemo(()=>{const t=L.current;return!!(C.length&&t&&t.contains(document.activeElement))},[C,L.current]),F=e.useMemo(()=>q&&C[C.length-1]?.id,[q,C]);e.useEffect(()=>{if(u&&q&&u){const{id:t}=u,f=L.current?.querySelector(`.wx-bar[data-id='${t}']`);f&&f.focus({preventScroll:!0})}},[u]),e.useEffect(()=>{const t=L.current;if(t&&(W(t.offsetWidth||0),typeof ResizeObserver<"u")){const f=new ResizeObserver(y=>{y[0]&&W(y[0].contentRect.width)});return f.observe(t),()=>f.disconnect()}},[L.current]);const fe=e.useCallback(()=>{document.body.style.userSelect="none"},[]),xe=e.useCallback(()=>{document.body.style.userSelect=""},[]),me=e.useCallback((t,f,y)=>{if(f.target.classList.contains("wx-line")||(y||(y=r.getTask($e(t))),y.type==="milestone"||y.type==="summary"))return"";const M=de.locate(f,"data-segment");M&&(t=M);const{left:Y,width:he}=t.getBoundingClientRect(),ge=(f.clientX-Y)/he;let we=.2/(he>200?he/200:1);return ge<we?"start":ge>1-we?"end":""},[r]),ue=e.useCallback((t,f)=>{const{clientX:y}=f,M=$e(t),Y=r.getTask(M),he=f.target.classList;if(!f.target.closest(".wx-delete-button")&&!f.target.closest("[data-interactive]")&&!n){if(he.contains("wx-progress-marker")){const{progress:ge}=r.getTask(M);B.current={id:M,x:y,progress:ge,dx:0,node:t,marker:f.target},f.target.classList.add("wx-progress-in-drag")}else{const ge=me(t,f,Y)||"move",we={id:M,mode:ge,x:y,dx:0,l:Y.$x,w:Y.$w};if($&&Y.segments?.length){const Se=de.locate(f,"data-segment");Se&&(we.segmentIndex=Se.dataset.segment*1,re.extendDragOptions(Y,we))}Z(we)}fe()}},[r,n,me,fe,$]),v=e.useCallback(t=>{if(t.button!==0)return;const f=de.locate(t);f&&ue(f,t)},[ue]),ee=e.useCallback(t=>{const f=de.locate(t);f&&(a.current=setTimeout(()=>{E(!0),ue(f,t.touches[0])},300))},[ue]),J=e.useCallback(t=>{K(t)},[]),ce=e.useCallback(()=>{if(B.current){const{dx:t,id:f,marker:y,value:M}=B.current;B.current=null,typeof M<"u"&&t&&r.exec("update-task",{id:f,task:{progress:M},inProgress:!1}),y.classList.remove("wx-progress-in-drag"),D.current=!0,xe()}else if(_){const{id:t,mode:f,dx:y,l:M,w:Y,start:he,segment:ge,index:we}=_;if(Z(null),he){const Se=Math.round(y/S);if(!Se)r.exec("drag-task",{id:t,width:Y,left:M,inProgress:!1,...ge&&{segmentIndex:we}});else{let Ne={},Re=r.getTask(t);ge&&(Re=Re.segments[we]),f==="move"?(Ne.start=Re.start,Ne.end=Re.end):Ne[f]=Re[f],r.exec("update-task",{id:t,diff:Se,task:Ne,...ge&&{segmentIndex:we}})}D.current=!0}xe()}},[r,xe,_,S]),ke=e.useCallback((t,f)=>{const{clientX:y}=f;if(!n)if(B.current){const{node:M,x:Y,id:he}=B.current,ge=B.current.dx=y-Y,we=Math.round(ge/M.offsetWidth*100);let Se=B.current.progress+we;B.current.value=Se=Math.min(Math.max(0,Se),100),r.exec("update-task",{id:he,task:{progress:Se},inProgress:!0})}else if(_){J(null);const{mode:M,l:Y,w:he,x:ge,id:we,start:Se,segment:Ne,index:Re}=_,Ae=r.getTask(we),Te=y-ge,We=Math.round(S)||1;if(!Se&&Math.abs(Te)<20||M==="start"&&he-Te<We||M==="end"&&he+Te<We||M==="move"&&(Te<0&&Y+Te<0||Te>0&&Y+he+Te>k)||_.segment&&!re.isSegmentMoveAllowed(Ae,_))return;const ze={..._,dx:Te};let Le,De;if(M==="start"?(Le=Y+Te,De=he-Te):M==="end"?(Le=Y,De=he+Te):M==="move"&&(Le=Y+Te,De=he),r.exec("drag-task",{id:we,width:De,left:Le,inProgress:!0,start:Se,...Ne&&{segmentIndex:Re}}),!ze.start&&(M==="move"&&Ae.$x==Y||M!=="move"&&Ae.$w==he)){D.current=!0,ce();return}ze.start=!0,Z(ze)}else{const M=de.locate(t);if(M){const Y=r.getTask($e(M)),ge=de.locate(t,"data-segment")||M,we=me(ge,f,Y);ge.style.cursor=we&&!n?"col-resize":"pointer"}}},[r,n,_,S,k,me,J,ce]),be=e.useCallback(t=>{ke(t,t)},[ke]),Ce=e.useCallback(t=>{U?(t.preventDefault(),ke(t,t.touches[0])):a.current&&(clearTimeout(a.current),a.current=null)},[U,ke]),se=e.useCallback(()=>{ce()},[ce]),pe=e.useCallback(()=>{E(null),a.current&&(clearTimeout(a.current),a.current=null),ce()},[ce]);e.useEffect(()=>(window.addEventListener("mouseup",se),()=>{window.removeEventListener("mouseup",se)}),[se]);const ye=e.useCallback(t=>{if(!n){if(t.target.closest("[data-interactive]"))return;const f=de.locateID(t.target);if(f&&!t.target.classList.contains("wx-link")){const y=de.locateID(t.target,"data-segment");r.exec("show-editor",{id:f,...y!==null&&{segmentIndex:y}})}}},[r,n]),te=["e2s","s2s","e2e","s2e"],ie=e.useCallback((t,f)=>te[(t?1:0)+(f?0:2)],[]),oe=e.useCallback((t,f)=>{const y=d.id,M=d.start;return t===y?!0:!!m.find(Y=>Y.target==t&&Y.source==y&&Y.type===ie(M,f))},[d,x,ie]),w=e.useCallback(()=>{d&&V(null)},[d]),X=e.useCallback(t=>{if(D.current){D.current=!1;return}if(t.target.closest("[data-interactive]"))return;const f=de.locateID(t.target);if(f){const y=t.target.classList;if(y.contains("wx-link")){const M=y.contains("wx-left");if(!d){V({id:f,start:M});return}d.id!==f&&!oe(f,M)&&r.exec("add-link",{link:{source:d.id,target:f,type:ie(d.start,M)}})}else if(y.contains("wx-delete-button-icon"))r.exec("delete-link",{id:Q}),K(null);else{let M;const Y=de.locate(t,"data-segment");Y&&(M=Y.dataset.segment*1),r.exec("select-task",{id:f,toggle:t.ctrlKey||t.metaKey,range:t.shiftKey,segmentIndex:M})}}w()},[r,d,x,A,oe,ie,w]),ae=e.useCallback(t=>({left:`${t.$x}px`,top:`${t.$y}px`,width:`${t.$w}px`,height:`${t.$h}px`}),[]),z=e.useCallback(t=>({left:`${t.$x_base}px`,top:`${t.$y_base}px`,width:`${t.$w_base}px`,height:`${t.$h_base}px`}),[]),ne=e.useCallback(t=>{if(U||a.current)return t.preventDefault(),!1},[U]),ve=e.useMemo(()=>h.map(t=>t.id),[h]),Ee=e.useCallback(t=>{let f=ve.includes(t)?t:"task";return["task","milestone","summary"].includes(t)||(f=`task ${f}`),f},[ve]),i=e.useCallback(t=>{r.exec(t.action,t.data)},[r]),p=e.useCallback(t=>O&&N.byId(t).$critical,[O,N]),T=e.useCallback(t=>{if(P?.auto){const f=N.getSummaryId(t,!0),y=N.getSummaryId(d.id,!0);return d?.id&&!(Array.isArray(f)?f:[f]).includes(d.id)&&!(Array.isArray(y)?y:[y]).includes(t)}return d},[P,N,d]);return l.jsxs("div",{className:"wx-GKbcLEGA wx-bars",style:{lineHeight:`${I.length?I[0].$h:0}px`},ref:L,onContextMenu:ne,onMouseDown:v,onMouseMove:be,onTouchStart:ee,onTouchMove:Ce,onTouchEnd:pe,onClick:X,onDoubleClick:ye,onDragStart:t=>(t.preventDefault(),!1),children:[l.jsx(tt,{onSelectLink:J,selectedLink:A,readonly:n}),I.map(t=>{if(t.$skip&&t.$skip_baseline)return null;const f=`wx-bar wx-${Ee(t.type)}`+(U&&_&&t.id===_.id?" wx-touch":"")+(d&&d.id===t.id?" wx-selected":"")+(p(t.id)?" wx-critical":"")+(t.$reorder?" wx-reorder-task":"")+($&&t.segments?" wx-split":""),y="wx-link wx-left"+(d?" wx-visible":"")+(!d||!oe(t.id,!0)&&T(t.id)?" wx-target":"")+(d&&d.id===t.id&&d.start?" wx-selected":"")+(p(t.id)?" wx-critical":""),M="wx-link wx-right"+(d?" wx-visible":"")+(!d||!oe(t.id,!1)&&T(t.id)?" wx-target":"")+(d&&d.id===t.id&&!d.start?" wx-selected":"")+(p(t.id)?" wx-critical":"");return l.jsxs(e.Fragment,{children:[!t.$skip&&l.jsxs("div",{className:"wx-GKbcLEGA "+f,style:ae(t),"data-tooltip-id":t.id,"data-id":t.id,tabIndex:F===t.id?0:-1,children:[n?null:t.id===A?.target&&A?.type[2]==="s"?l.jsx(le.Button,{type:"danger",css:"wx-left wx-delete-button wx-delete-link",children:l.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):l.jsx("div",{className:"wx-GKbcLEGA "+y,children:l.jsx("div",{className:"wx-GKbcLEGA wx-inner"})}),t.type!=="milestone"?l.jsxs(l.Fragment,{children:[t.progress&&!($&&t.segments)?l.jsx("div",{className:"wx-GKbcLEGA wx-progress-wrapper",children:l.jsx("div",{className:"wx-GKbcLEGA wx-progress-percent",style:{width:`${t.progress}%`}})}):null,!n&&!($&&t.segments)&&!(t.type=="summary"&&H?.autoProgress)?l.jsx("div",{className:"wx-GKbcLEGA wx-progress-marker",style:{left:`calc(${t.progress}% - 10px)`},children:t.progress}):null,o?l.jsx("div",{className:"wx-GKbcLEGA wx-content",children:l.jsx(o,{data:t,api:r,onAction:i})}):$&&t.segments?l.jsx(st,{task:t,type:Ee(t.type)}):l.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text||""})]}):l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"wx-GKbcLEGA wx-content"}),o?l.jsx(o,{data:t,api:r,onAction:i}):l.jsx("div",{className:"wx-GKbcLEGA wx-text-out",children:t.text})]}),n?null:t.id===A?.target&&A?.type[2]==="e"?l.jsx(le.Button,{type:"danger",css:"wx-right wx-delete-button wx-delete-link",children:l.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):l.jsx("div",{className:"wx-GKbcLEGA "+M,children:l.jsx("div",{className:"wx-GKbcLEGA wx-inner"})})]}),G&&!t.$skip_baseline?l.jsx("div",{className:"wx-GKbcLEGA wx-baseline"+(t.type==="milestone"?" wx-milestone":""),style:z(t)}):null]},t.id)})]})}function rt(s){const{highlightTime:n}=s,o=e.useContext(Me),r=b.useStore(o,"_scales");return l.jsx("div",{className:"wx-ZkvhDKir wx-scale",style:{width:r.width},children:(r?.rows||[]).map((c,j)=>l.jsx("div",{className:"wx-ZkvhDKir wx-row",style:{height:`${c.height}px`},children:(c.cells||[]).map((m,x)=>{const g=n?n(m.date,m.unit):"",R="wx-cell "+(m.css||"")+" "+(g||"");return l.jsx("div",{className:"wx-ZkvhDKir "+R,style:{width:`${m.width}px`},children:m.value},x)})},j))})}const ot=new Map;function lt(s){const n=e.useRef(null),o=e.useRef(0),r=e.useRef(null),c=typeof window<"u"&&window.__RENDER_METRICS_ENABLED__;n.current===null&&(n.current=performance.now()),o.current++,e.useEffect(()=>{if(c)return cancelAnimationFrame(r.current),r.current=requestAnimationFrame(()=>{const j={label:s,time:performance.now()-n.current,renders:o.current,timestamp:Date.now()};ot.set(s,j),window.dispatchEvent(new CustomEvent("render-metric",{detail:j}))}),()=>cancelAnimationFrame(r.current)})}function ct(s){const{readonly:n,fullWidth:o,fullHeight:r,taskTemplate:c,cellBorders:j,highlightTime:m}=s,x=e.useContext(Me),[g,R]=b.useStoreWithCounter(x,"_selected"),h=b.useStore(x,"scrollTop"),G=b.useStore(x,"cellHeight"),C=b.useStore(x,"cellWidth"),u=b.useStore(x,"_scales"),O=b.useStore(x,"_markers"),N=b.useStore(x,"_scrollTask"),P=b.useStore(x,"zoom"),[$,H]=e.useState(),I=e.useRef(null),S=1+(u?.rows?.length||0),D=e.useMemo(()=>{const a=[];return g&&g.length&&G&&g.forEach(k=>{a.push({height:`${G}px`,top:`${k.$y-3}px`})}),a},[R,G]),d=e.useMemo(()=>Math.max($||0,r),[$,r]);e.useEffect(()=>{const a=I.current;a&&typeof h=="number"&&(a.scrollTop=h)},[h]);const V=()=>{_()};function _(a){const k=I.current;if(!k)return;const W={};W.left=k.scrollLeft,x.exec("scroll-chart",W)}function Z(){const a=I.current,W=Math.ceil(($||0)/(G||1))+1,L=Math.floor((a&&a.scrollTop||0)/(G||1)),q=Math.max(0,L-S),F=L+W+S,fe=q*(G||0);x.exec("render-data",{start:q,end:F,from:fe})}e.useEffect(()=>{Z()},[$,h]);const B=e.useCallback(a=>{if(!a)return;const{id:k,mode:W}=a;if(W.toString().indexOf("x")<0)return;const L=I.current;if(!L)return;const{clientWidth:q}=L,F=x.getTask(k);if(F.$x+F.$w<L.scrollLeft)x.exec("scroll-chart",{left:F.$x-(C||0)}),L.scrollLeft=F.$x-(C||0);else if(F.$x>=q+L.scrollLeft){const fe=q<F.$w?C||0:F.$w;x.exec("scroll-chart",{left:F.$x-q+fe}),L.scrollLeft=F.$x-q+fe}},[x,C]);e.useEffect(()=>{B(N)},[N]);function Q(a){if(P&&(a.ctrlKey||a.metaKey)){a.preventDefault();const k=I.current,W=-Math.sign(a.deltaY),L=a.clientX-(k?k.getBoundingClientRect().left:0);x.exec("zoom-scale",{dir:W,offset:L})}}function K(a){const k=m(a.date,a.unit);return k?{css:k,width:a.width}:null}const A=e.useMemo(()=>u&&(u.minUnit==="hour"||u.minUnit==="day")&&m?u.rows[u.rows.length-1].cells.map(K):null,[u,m]),U=e.useCallback(a=>{a.eventSource="chart",x.exec("hotkey",a)},[x]);e.useEffect(()=>{const a=I.current;if(!a)return;const k=()=>H(a.clientHeight);k();const W=new ResizeObserver(()=>k());return W.observe(a),()=>{W.disconnect()}},[I.current]);const E=e.useRef(null);return e.useEffect(()=>{const a=I.current;if(a&&!E.current)return E.current=Fe.hotkeys(a,{keys:{arrowup:!0,arrowdown:!0},exec:k=>U(k)}),()=>{E.current?.destroy(),E.current=null}},[]),e.useEffect(()=>{const a=I.current;if(!a)return;const k=Q;return a.addEventListener("wheel",k),()=>{a.removeEventListener("wheel",k)}},[Q]),lt("chart"),l.jsxs("div",{className:"wx-mR7v2Xag wx-chart",tabIndex:-1,ref:I,onScroll:V,children:[l.jsx(rt,{highlightTime:m,scales:u}),O&&O.length?l.jsx("div",{className:"wx-mR7v2Xag wx-markers",style:{height:`${d}px`},children:O.map((a,k)=>l.jsx("div",{className:`wx-mR7v2Xag wx-marker ${a.css||""}`,style:{left:`${a.left}px`},children:l.jsx("div",{className:"wx-mR7v2Xag wx-content",children:a.text})},k))}):null,l.jsxs("div",{className:"wx-mR7v2Xag wx-area",style:{width:`${o}px`,height:`${d}px`},children:[A?l.jsx("div",{className:"wx-mR7v2Xag wx-gantt-holidays",style:{height:"100%"},children:A.map((a,k)=>a?l.jsx("div",{className:"wx-mR7v2Xag "+a.css,style:{width:`${a.width}px`,left:`${k*a.width}px`}},k):null)}):null,l.jsx(et,{borders:j}),g&&g.length?g.map((a,k)=>a.$y?l.jsx("div",{className:"wx-mR7v2Xag wx-selected","data-id":a.id,style:D[k]},a.id):null):null,l.jsx(nt,{readonly:n,taskTemplate:c})]})]})}function it(s){const{position:n="after",size:o=4,dir:r="x",onMove:c,onDisplayChange:j,compactMode:m,containerWidth:x=0,leftThreshold:g=50,rightThreshold:R=50}=s,[h,G]=b.useWritableProp(s.value??0),[C,u]=b.useWritableProp(s.display??"all");function O(W){let L=0;n=="center"?L=o/2:n=="before"&&(L=o);const q={size:[o+"px","auto"],p:[W-L+"px","0px"],p2:["auto","0px"]};if(r!="x")for(let F in q)q[F]=q[F].reverse();return q}const[N,P]=e.useState(!1),[$,H]=e.useState(null),I=e.useRef(0),S=e.useRef(),D=e.useRef(),d=e.useRef(C);e.useEffect(()=>{d.current=C},[C]),e.useEffect(()=>{$===null&&h>0&&H(h)},[$,h]);function V(W){return r=="x"?W.clientX:W.clientY}const _=e.useCallback(W=>{const L=S.current+V(W)-I.current;G(L);let q;L<=g?q="chart":x-L<=R?q="grid":q="all",d.current!==q&&(u(q),d.current=q),D.current&&clearTimeout(D.current),D.current=setTimeout(()=>c&&c(L),100)},[x,g,R,c]),Z=e.useCallback(()=>{document.body.style.cursor="",document.body.style.userSelect="",P(!1),window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",Z)},[_]),B=e.useMemo(()=>C!=="all"?"auto":r=="x"?"ew-resize":"ns-resize",[C,r]),Q=e.useCallback(W=>{!m&&(C==="grid"||C==="chart")||(I.current=V(W),S.current=h,P(!0),document.body.style.cursor=B,document.body.style.userSelect="none",window.addEventListener("mousemove",_),window.addEventListener("mouseup",Z))},[B,_,Z,h,m,C]);function K(){u("all"),$!==null&&(G($),c&&c($))}function A(W){if(m){const L=C==="chart"?"grid":"chart";u(L),j(L)}else if(C==="grid"||C==="chart")K(),j("all");else{const L=W==="left"?"chart":"grid";u(L),j(L)}}function U(){A("left")}function E(){A("right")}const a=e.useMemo(()=>O(h),[h,n,o,r]),k=["wx-resizer",`wx-resizer-${r}`,`wx-resizer-display-${C}`,N?"wx-resizer-active":""].filter(Boolean).join(" ");return l.jsxs("div",{className:"wx-pFykzMlT "+k,onMouseDown:Q,style:{width:a.size[0],height:a.size[1],cursor:B},children:[l.jsxs("div",{className:"wx-pFykzMlT wx-button-expand-box",children:[l.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-left",children:l.jsx("i",{className:"wx-pFykzMlT wxi-menu-left",onClick:U})}),l.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-right",children:l.jsx("i",{className:"wx-pFykzMlT wxi-menu-right",onClick:E})})]}),l.jsx("div",{className:"wx-pFykzMlT wx-resizer-line"})]})}const at=650;function Ke(s){let n;function o(){n=new ResizeObserver(c=>{for(let j of c)if(j.target===document.body){let m=j.contentRect.width<=at;s(m)}}),n.observe(document.body)}function r(){n&&(n.disconnect(),n=null)}return{observe:o,disconnect:r}}function ut(s){const{taskTemplate:n,readonly:o,cellBorders:r,highlightTime:c,onTableAPIChange:j}=s,m=e.useContext(Me),x=b.useStore(m,"_tasks"),g=b.useStore(m,"_scales"),R=b.useStore(m,"cellHeight"),h=b.useStore(m,"columns"),G=b.useStore(m,"_scrollTask"),C=b.useStore(m,"undo"),[u,O]=e.useState(!1);let[N,P]=e.useState(0);const[$,H]=e.useState(0),[I,S]=e.useState(0),[D,d]=e.useState(void 0),[V,_]=e.useState("all"),Z=e.useRef(null),B=e.useCallback(v=>{O(ee=>(v!==ee&&(v?(Z.current=V,V==="all"&&_("grid")):(!Z.current||Z.current==="all")&&_("all")),v))},[V]);e.useEffect(()=>{const v=Ke(B);return v.observe(),()=>{v.disconnect()}},[B]);const Q=e.useMemo(()=>{let v;return h.every(ee=>ee.width&&!ee.flexgrow)?v=h.reduce((ee,J)=>ee+parseInt(J.width),0):u&&V==="chart"?v=parseInt(h.find(ee=>ee.id==="action")?.width)||50:v=440,N=v,v},[h,u,V]);e.useEffect(()=>{P(Q)},[Q]);const K=e.useMemo(()=>($??0)-(D??0),[$,D]),A=e.useMemo(()=>g.width,[g]),U=e.useMemo(()=>x.length*R,[x,R]),E=e.useMemo(()=>g.height+U+K,[g,U,K]),a=e.useMemo(()=>N+A,[N,A]),k=e.useRef(null),W=e.useCallback(()=>{Promise.resolve().then(()=>{if(($??0)>(a??0)){const v=($??0)-N;m.exec("expand-scale",{minWidth:v})}})},[$,a,N,m]);e.useEffect(()=>{let v;return k.current&&(v=new ResizeObserver(W),v.observe(k.current)),()=>{v&&v.disconnect()}},[k.current,W]),e.useEffect(()=>{W()},[A]);const L=e.useRef(null),q=e.useRef(null),F=e.useCallback(()=>{const v=L.current;v&&m.exec("scroll-chart",{top:v.scrollTop})},[m]),fe=e.useRef({rTasks:[],rScales:{height:0},rCellHeight:0,scrollSize:0,ganttDiv:null,ganttHeight:0});e.useEffect(()=>{fe.current={rTasks:x,rScales:g,rCellHeight:R,scrollSize:K,ganttDiv:L.current,ganttHeight:I??0}},[x,g,R,K,I]);const xe=e.useCallback(v=>{if(!v)return;const{rTasks:ee,rScales:J,rCellHeight:ce,scrollSize:ke,ganttDiv:be,ganttHeight:Ce}=fe.current;if(!be)return;const{id:se}=v,pe=ee.findIndex(ye=>ye.id===se);if(pe>-1){const ye=Ce-J.height,te=pe*ce,ie=be.scrollTop;let oe=null;te<ie?oe=te:te+ce>ie+ye&&(oe=te-ye+ce+ke),oe!==null&&(m.exec("scroll-chart",{top:Math.max(oe,0)}),L.current.scrollTop=Math.max(oe,0))}},[m]);e.useEffect(()=>{xe(G)},[G]),e.useEffect(()=>{const v=L.current,ee=q.current;if(!v||!ee)return;const J=()=>{Xe.flushSync(()=>{S(v.offsetHeight),H(v.offsetWidth),d(ee.offsetWidth)})},ce=new ResizeObserver(J);return ce.observe(v),()=>ce.disconnect()},[L.current]);const me=e.useRef(null),ue=e.useRef(null);return e.useEffect(()=>{ue.current&&(ue.current.destroy(),ue.current=null);const v=me.current;if(v)return ue.current=Fe.hotkeys(v,{keys:{"ctrl+c":!0,"ctrl+v":!0,"ctrl+x":!0,"ctrl+d":!0,backspace:!0,"ctrl+z":C,"ctrl+y":C},exec:ee=>{ee.isInput||m.exec("hotkey",ee)}}),()=>{ue.current?.destroy(),ue.current=null}},[C]),l.jsx("div",{className:"wx-jlbQoHOz wx-gantt",ref:L,onScroll:F,children:l.jsx("div",{className:"wx-jlbQoHOz wx-pseudo-rows",style:{height:E,width:"100%"},ref:q,children:l.jsx("div",{className:"wx-jlbQoHOz wx-stuck",style:{height:I,width:D},children:l.jsxs("div",{tabIndex:0,className:"wx-jlbQoHOz wx-layout",ref:me,children:[h.length?l.jsxs(l.Fragment,{children:[l.jsx(Je,{display:V,compactMode:u,columnWidth:Q,width:N,readonly:o,fullHeight:U,onTableAPIChange:j}),l.jsx(it,{value:N,display:V,compactMode:u,containerWidth:$,onMove:v=>P(v),onDisplayChange:v=>_(v)})]}):null,l.jsx("div",{className:"wx-jlbQoHOz wx-content",ref:k,children:l.jsx(ct,{readonly:o,fullWidth:A,fullHeight:U,taskTemplate:n,cellBorders:r,highlightTime:c})})]})})})})}function dt(s){return{year:"%Y",quarter:`${s("Q")} %Q`,month:"%M",week:`${s("Week")} %w`,day:"%M %j",hour:"%H:%i"}}function ft(s,n){return typeof s=="function"?s:de.dateToString(s,n)}function qe(s,n){return s.map(({format:o,...r})=>({...r,format:ft(o,n)}))}function xt(s,n){const o=dt(n);for(let r in o)o[r]=de.dateToString(o[r],s);return o}function mt(s,n){if(!s||!s.length)return s;const o=de.dateToString("%d-%m-%Y",n);return s.map(r=>r.template?r:r.id==="start"||r.id=="end"?{...r,_template:c=>o(c),template:c=>o(c)}:r.id==="duration"?{...r,_template:c=>c,template:c=>c}:r)}function ht(s,n){return s.levels?{...s,levels:s.levels.map(o=>({...o,scales:qe(o.scales,n)}))}:s}const gt=s=>s.split("-").map(n=>n?n.charAt(0).toUpperCase()+n.slice(1):"").join(""),wt=[{unit:"month",step:1,format:"%F %Y"},{unit:"day",step:1,format:"%j"}],pt=e.forwardRef(function({taskTemplate:n=null,markers:o=[],taskTypes:r=re.defaultTaskTypes,tasks:c=[],selected:j=[],activeTask:m=null,links:x=[],scales:g=wt,columns:R=re.defaultColumns,start:h=null,end:G=null,lengthUnit:C="day",durationUnit:u="day",cellWidth:O=100,cellHeight:N=38,scaleHeight:P=36,readonly:$=!1,cellBorders:H="full",zoom:I=!1,baselines:S=!1,highlightTime:D=null,init:d=null,autoScale:V=!0,unscheduledTasks:_=!1,criticalPath:Z=null,schedule:B={type:"forward"},projectStart:Q=null,projectEnd:K=null,calendar:A=null,undo:U=!1,splitTasks:E=!1,summary:a=null,_export:k=!1,...W},L){const q=e.useRef();q.current=W;const F=e.useMemo(()=>new re.DataStore(b.writable),[]),fe=e.useMemo(()=>({...He.en,...Ie.en}),[]),xe=e.useContext(le.context.i18n),me=e.useMemo(()=>xe?xe.extend(fe,!0):de.locale(fe),[xe,fe]),ue=e.useMemo(()=>me.getRaw().calendar,[me]),v=e.useMemo(()=>{let te={zoom:ht(I,ue),scales:qe(g,ue),columns:mt(R,ue),links:re.normalizeLinks(x),cellWidth:O};return te.zoom&&(te={...te,...re.normalizeZoom(te.zoom,xt(ue,me.getGroup("gantt")),te.scales,O)}),te},[I,g,R,x,O,ue,me]),ee=e.useRef(null);ee.current!==c&&(k||re.parseTaskDates(c,{durationUnit:u,splitTasks:E,calendar:A}),ee.current=c),e.useEffect(()=>{k||re.parseTaskDates(c,{durationUnit:u,splitTasks:E,calendar:A})},[c,u,A,E,k]);const J=e.useMemo(()=>F.in,[F]),ce=e.useRef(null);ce.current===null&&(ce.current=new Be.EventBusRouter((te,ie)=>{const oe="on"+gt(te);q.current&&q.current[oe]&&q.current[oe](ie)}),J.setNext(ce.current));const[ke,be]=e.useState(null),Ce=e.useRef(null);Ce.current=ke;const se=e.useMemo(()=>({getState:F.getState.bind(F),getReactiveState:F.getReactive.bind(F),getStores:()=>({data:F}),exec:J.exec.bind(J),setNext:te=>(ce.current=ce.current.setNext(te),ce.current),intercept:J.intercept.bind(J),on:J.on.bind(J),detach:J.detach.bind(J),getTask:F.getTask.bind(F),serialize:()=>F.serialize(),getTable:te=>te?new Promise(ie=>setTimeout(()=>ie(Ce.current),1)):Ce.current,getHistory:()=>F.getHistory()}),[F,J]);e.useEffect(()=>{const te=()=>{const{zoom:ie,scales:oe}=se.getState(),X=ie?.levels?.[ie.level]?.scales?.[0]?.unit??oe?.[0]?.unit;X&&se.exec("scale-change",{level:ie?.level,unit:X})};se.on("zoom-scale",te),se.on("set-scale",te)},[se]),e.useEffect(()=>{se.intercept("set-scale",({unit:te,date:ie})=>{const{zoom:oe}=se.getState();if(!oe||!oe.levels)return!1;const w=oe.levels.findIndex(z=>z.scales.some(ne=>ne.unit===te));if(w<0)return!1;const X=oe.levels[w];if(w!==oe.level){const z=Math.round((X.minCellWidth+X.maxCellWidth)/2);se.getStores().data.setState({scales:X.scales,cellWidth:z,_cellWidth:z,zoom:{...oe,level:w},...ie?{_scaleDate:ie,_zoomOffset:0}:{}})}else if(ie){const{_scales:z,cellWidth:ne}=se.getState(),ve=z.diff(ie,z.start,z.lengthUnit),Ee=Math.max(0,Math.round(ve*ne));se.exec("scroll-chart",{left:Ee})}return!1})},[se]),e.useImperativeHandle(L,()=>({...se}),[se]);const pe=e.useRef(0);e.useEffect(()=>{pe.current?F.init({tasks:c,links:v.links,start:h,columns:v.columns,end:G,lengthUnit:C,cellWidth:v.cellWidth,cellHeight:N,scaleHeight:P,scales:v.scales,taskTypes:r,zoom:v.zoom,selected:j,activeTask:m,baselines:S,autoScale:V,unscheduledTasks:_,markers:o,durationUnit:u,criticalPath:Z,schedule:B,projectStart:Q,projectEnd:K,calendar:A,undo:U,_weekStart:ue.weekStart,splitTasks:E,summary:a}):d&&d(se),pe.current++},[se,d,c,v,h,G,C,N,P,r,j,m,S,V,_,o,u,Z,B,Q,K,A,U,ue,E,a,F]),pe.current===0&&F.init({tasks:c,links:v.links,start:h,columns:v.columns,end:G,lengthUnit:C,cellWidth:v.cellWidth,cellHeight:N,scaleHeight:P,scales:v.scales,taskTypes:r,zoom:v.zoom,selected:j,activeTask:m,baselines:S,autoScale:V,unscheduledTasks:_,markers:o,durationUnit:u,criticalPath:Z,schedule:B,projectStart:Q,projectEnd:K,calendar:A,undo:U,_weekStart:ue.weekStart,splitTasks:E,summary:a});const ye=e.useMemo(()=>A?(te,ie)=>ie=="day"&&!A.getDayHours(te)||ie=="hour"&&!A.getDayHours(te)?"wx-weekend":"":D,[A,D]);return l.jsx(le.context.i18n.Provider,{value:me,children:l.jsx(Me.Provider,{value:se,children:l.jsx(ut,{taskTemplate:n,readonly:$,cellBorders:H,highlightTime:ye,onTableAPIChange:be})})})});function bt({api:s=null,items:n=[]}){const o=e.useContext(le.context.i18n),r=e.useMemo(()=>o||de.locale(Ie.en),[o]),c=e.useMemo(()=>r.getGroup("gantt"),[r]),j=b.useStoreLater(s,"_selected"),m=b.useStoreLater(s,"undo"),x=b.useStoreLater(s,"history"),g=b.useStoreLater(s,"splitTasks"),R=["undo","redo"],h=e.useMemo(()=>{const C=re.getToolbarButtons({undo:!0,splitTasks:!0});return(n.length?n:re.getToolbarButtons({undo:m,splitTasks:g})).map(O=>{let N={...O,disabled:!1};return N.handler=re.isHandledAction(C,N.id)?P=>re.handleAction(s,P.id,null,c):N.handler,N.text&&(N.text=c(N.text)),N.menuText&&(N.menuText=c(N.menuText)),N})},[n,s,c,m,g]),G=e.useMemo(()=>{const C=[];return h.forEach(u=>{const O=u.id;if(O==="add-task")C.push(u);else if(R.includes(O))R.includes(O)&&C.push({...u,disabled:u.isDisabled(x)});else{if(!j?.length||!s)return;C.push({...u,disabled:u.isDisabled&&j.some(N=>u.isDisabled(N,s.getState()))})}}),C.filter((u,O)=>{if(s&&u.isHidden)return!j.some(N=>u.isHidden(N,s.getState()));if(u.comp==="separator"){const N=C[O+1];if(!N||N.comp==="separator")return!1}return!0})},[s,j,x,h]);return o?l.jsx(Ge.Toolbar,{items:G}):l.jsx(le.context.i18n.Provider,{value:r,children:l.jsx(Ge.Toolbar,{items:G})})}const kt=e.forwardRef(function({options:n=[],api:o=null,resolver:r=null,filter:c=null,at:j="point",children:m,onClick:x,css:g},R){const h=e.useRef(null),G=e.useRef(null),C=e.useContext(le.context.i18n),u=e.useMemo(()=>C||de.locale({...Ie.en,...He.en}),[C]),O=e.useMemo(()=>u.getGroup("gantt"),[u]),N=b.useStoreLater(o,"taskTypes"),P=b.useStoreLater(o,"selected"),$=b.useStoreLater(o,"_selected"),H=b.useStoreLater(o,"splitTasks"),I=b.useStoreLater(o,"summary"),S=e.useMemo(()=>({splitTasks:H,taskTypes:N,summary:I}),[H,N,I]),D=e.useMemo(()=>re.getMenuOptions(S),[S]);e.useEffect(()=>{o&&(o.on("scroll-chart",()=>{h.current&&h.current.show&&h.current.show()}),o.on("drag-task",()=>{h.current&&h.current.show&&h.current.show()}))},[o]);function d(E){return E.map(a=>(a={...a},a.text&&(a.text=O(a.text)),a.subtext&&(a.subtext=O(a.subtext)),a.data&&(a.data=d(a.data)),a))}function V(){const E=n.length?n:re.getMenuOptions(S);return d(E)}const _=e.useMemo(()=>V(),[o,n,S,O]),Z=e.useMemo(()=>$&&$.length?$:[],[$]),B=e.useCallback((E,a)=>{let k=E?o?.getTask(E):null;if(r){const W=r(E,a);k=W===!0?k:W}if(k){const W=de.locateID(a.target,"data-segment");W!==null?G.current={id:k.id,segmentIndex:W}:G.current=k.id,(!Array.isArray(P)||!P.includes(k.id))&&o&&o.exec&&o.exec("select-task",{id:k.id})}return k},[o,r,P]),Q=e.useCallback(E=>{const a=E.action;a&&(re.isHandledAction(D,a.id)&&re.handleAction(o,a.id,G.current,O),x&&x(E))},[o,O,x,D]),K=e.useCallback((E,a)=>{const k=Z.length?Z:a?[a]:[];let W=c?k.every(L=>c(E,L)):!0;if(W&&(E.isHidden&&(W=!k.some(L=>E.isHidden(L,o.getState(),G.current))),E.isDisabled)){const L=k.some(q=>E.isDisabled(q,o.getState(),G.current));E.disabled=L}return W},[c,Z,o]);e.useImperativeHandle(R,()=>({show:(E,a)=>{h.current&&h.current.show&&h.current.show(E,a)}}));const A=e.useCallback(E=>{h.current&&h.current.show&&h.current.show(E)},[]),U=l.jsxs(l.Fragment,{children:[l.jsx(Ye.ContextMenu,{filter:K,options:_,dataKey:"id",resolver:B,onClick:Q,at:j,ref:h,css:g}),l.jsx("span",{onContextMenu:A,"data-menu-ignore":"true",children:typeof m=="function"?m():m})]});if(!C&&le.context.i18n?.Provider){const E=le.context.i18n.Provider;return l.jsx(E,{value:u,children:U})}return U});function yt({api:s,autoSave:n,onLinksChange:o}){const c=e.useContext(le.context.i18n).getGroup("gantt"),j=b.useStore(s,"activeTask"),m=b.useStore(s,"_activeTask"),x=b.useStore(s,"_links"),g=b.useStore(s,"schedule"),R=b.useStore(s,"unscheduledTasks"),[h,G]=e.useState();function C(){if(j){const P=x.filter(H=>H.target==j).map(H=>({link:H,task:s.getTask(H.source)})),$=x.filter(H=>H.source==j).map(H=>({link:H,task:s.getTask(H.target)}));return[{title:c("Predecessors"),data:P},{title:c("Successors"),data:$}]}}e.useEffect(()=>{G(C())},[j,x]);const u=e.useMemo(()=>[{id:"e2s",label:c("End-to-start")},{id:"s2s",label:c("Start-to-start")},{id:"e2e",label:c("End-to-end")},{id:"s2e",label:c("Start-to-end")}],[c]);function O(P){n?s.exec("delete-link",{id:P}):(G($=>($||[]).map(H=>({...H,data:H.data.filter(I=>I.link.id!==P)}))),o&&o({id:P,action:"delete-link",data:{id:P}}))}function N(P,$){n?s.exec("update-link",{id:P,link:$}):(G(H=>(H||[]).map(I=>({...I,data:I.data.map(S=>S.link.id===P?{...S,link:{...S.link,...$}}:S)}))),o&&o({id:P,action:"update-link",data:{id:P,link:$}}))}return l.jsx(l.Fragment,{children:(h||[]).map((P,$)=>P.data.length?l.jsx("div",{className:"wx-j93aYGQf wx-links",children:l.jsx(le.context.fieldId.Provider,{value:null,children:l.jsx(le.Field,{label:P.title,position:"top",children:l.jsx("table",{children:l.jsx("tbody",{children:P.data.map(H=>l.jsxs("tr",{children:[l.jsx("td",{className:"wx-j93aYGQf wx-cell",children:l.jsx("div",{className:"wx-j93aYGQf wx-task-name",children:H.task.text||""})}),g?.auto&&H.link.type==="e2s"?l.jsx("td",{className:"wx-j93aYGQf wx-cell wx-link-lag",children:l.jsx(le.Text,{type:"number",placeholder:c("Lag"),value:H.link.lag,disabled:R&&m?.unscheduled,onChange:I=>{I.input||N(H.link.id,{lag:I.value})}})}):null,l.jsx("td",{className:"wx-j93aYGQf wx-cell",children:l.jsx("div",{className:"wx-j93aYGQf wx-wrapper",children:l.jsx(le.Combo,{value:H.link.type,placeholder:c("Select link type"),options:u,onChange:I=>N(H.link.id,{type:I.value}),children:({option:I})=>I.label})})}),l.jsx("td",{className:"wx-j93aYGQf wx-cell",children:l.jsx("i",{className:"wx-j93aYGQf wxi-delete wx-delete-icon",onClick:()=>O(H.link.id),role:"button"})})]},H.link.id))})})})})},$):null)})}function vt(s){const{value:n,time:o,format:r,onchange:c,onChange:j,...m}=s,x=j??c;function g(R){const h=new Date(R.value);h.setHours(n.getHours()),h.setMinutes(n.getMinutes()),x&&x({value:h})}return l.jsxs("div",{className:"wx-hFsbgDln date-time-controll",children:[l.jsx(le.DatePicker,{...m,value:n,onChange:g,format:r,buttons:["today"],clear:!1}),o?l.jsx(le.TimePicker,{value:n,onChange:x,format:r}):null]})}je.registerEditorItem("select",le.RichSelect);je.registerEditorItem("date",vt);je.registerEditorItem("twostate",le.TwoState);je.registerEditorItem("slider",le.Slider);je.registerEditorItem("counter",le.Counter);je.registerEditorItem("links",yt);function Ct({api:s,items:n=[],css:o="",layout:r="default",readonly:c=!1,placement:j="sidebar",bottomBar:m=!0,topBar:x=!0,autoSave:g=!0,focus:R=!1,hotkeys:h={}}){const G=e.useContext(le.context.i18n),C=e.useMemo(()=>G||de.locale({...Ie.en,...He.en}),[G]),u=e.useMemo(()=>C.getGroup("gantt"),[C]),O=C.getRaw(),N=e.useMemo(()=>{const w=O.gantt?.dateFormat||O.formats?.dateFormat;return de.dateToString(w,O.calendar)},[O]),P=e.useMemo(()=>{if(x===!0&&!c){const w=[{comp:"icon",icon:"wxi-close",id:"close"},{comp:"spacer"},{comp:"button",type:"danger",text:u("Delete"),id:"delete"}];return g?{items:w}:{items:[...w,{comp:"button",type:"primary",text:u("Save"),id:"save"}]}}return x},[x,c,g,u]),[$,H]=e.useState(!1),I=e.useMemo(()=>$?"wx-full-screen":"",[$]),S=e.useCallback(w=>{H(w)},[]);e.useEffect(()=>{const w=Ke(S);return w.observe(),()=>{w.disconnect()}},[S]);const D=b.useStore(s,"_activeTask"),d=b.useStore(s,"activeTask"),V=b.useStore(s,"unscheduledTasks"),_=b.useStore(s,"summary"),Z=b.useStore(s,"links"),B=b.useStore(s,"splitTasks"),Q=e.useMemo(()=>B&&d?.segmentIndex,[B,d]),K=e.useMemo(()=>Q||Q===0,[Q]),A=b.useStore(s,"taskTypes"),U=e.useMemo(()=>re.getEditorItems({unscheduledTasks:V,summary:_,taskTypes:A}),[V,_,A]),E=b.useStore(s,"undo"),[a,k]=e.useState({}),[W,L]=e.useState(null),[q,F]=e.useState(),[fe,xe]=e.useState(null),me=e.useMemo(()=>{if(!D)return null;let w;if(K&&D.segments?w={...D.segments[Q]}:w={...D},c){let X={parent:w.parent};return U.forEach(({key:ae,comp:z})=>{if(z!=="links"){const ne=w[ae];z==="date"&&ne instanceof Date?X[ae]=N(ne):z==="slider"&&ae==="progress"?X[ae]=`${ne}%`:X[ae]=ne}}),X}return w||null},[D,K,Q,c,U,N]);e.useEffect(()=>{F(me)},[me]),e.useEffect(()=>{k({}),xe(null),L(null)},[d]);function ue(w,X){return w.map(ae=>{const z={...ae};if(ae.config&&(z.config={...z.config}),z.comp==="links"&&s&&(z.api=s,z.autoSave=g,z.onLinksChange=J),z.comp==="select"&&z.key==="type"){const ne=z.options??[];z.options=ne.map(ve=>({...ve,label:u(ve.label)}))}return z.comp==="slider"&&z.key==="progress"&&(z.labelTemplate=ne=>`${u(z.label)} ${ne}%`),z.label&&(z.label=u(z.label)),z.config?.placeholder&&(z.config.placeholder=u(z.config.placeholder)),X&&(z.isDisabled&&z.isDisabled(X,s.getState())?z.disabled=!0:delete z.disabled),z})}const v=e.useMemo(()=>{let w=n.length?n:U;return w=ue(w,q),q?w.filter(X=>!X.isHidden||!X.isHidden(q,s.getState())):w},[n,U,q,u,s,g]),ee=e.useMemo(()=>v.map(w=>w.key),[v]);function J({id:w,action:X,data:ae}){k(z=>({...z,[w]:{action:X,data:ae}}))}const ce=e.useCallback(()=>{for(let w in a)if(Z.byId(w)){const{action:X,data:ae}=a[w];s.exec(X,ae)}},[s,a,Z]),ke=e.useCallback(()=>{const w=d?.id||d;if(K){if(D?.segments){const X=D.segments.filter((ae,z)=>z!==Q);s.exec("update-task",{id:w,task:{segments:X}})}}else s.exec("delete-task",{id:w})},[s,d,K,D,Q]),be=e.useCallback(()=>{s.exec("show-editor",{id:null})},[s]),Ce=e.useCallback(w=>{const{item:X,changes:ae}=w;X.id==="delete"&&ke(),X.id==="save"&&(ae.length?be():ce()),X.comp&&be()},[s,d,g,ce,ke,be]),se=e.useCallback((w,X,ae)=>(V&&w.type==="summary"&&(w.unscheduled=!1),re.prepareEditTask(w,s.getState(),X),ae||L(!1),w),[V,s]),pe=e.useCallback(w=>{w={...w,unscheduled:V&&w.unscheduled&&w.type!=="summary"},delete w.links,delete w.data,(ee.indexOf("duration")===-1||w.segments&&!w.duration)&&delete w.duration;const X={id:d?.id||d,task:w,...K&&{segmentIndex:Q}};g&&W&&(X.inProgress=W),s.exec("update-task",X),g||ce()},[s,d,V,g,ce,ee,K,Q,W]),ye=e.useCallback(w=>{let{update:X,key:ae,input:z}=w;if(z&&L(!0),w.update=se({...X},ae,z),!g)F(w.update);else if(!fe&&!z){const ne=v.find(i=>i.key===ae),ve=X[ae];(!ne.validation||ne.validation(ve))&&(!ne.required||ve)&&pe(w.update)}},[g,se,fe,v,pe]),te=e.useCallback(w=>{g||pe(w.values)},[g,pe]),ie=e.useCallback(w=>{xe(w.errors)},[]),oe=e.useMemo(()=>E?{"ctrl+z":w=>{w.preventDefault(),s.exec("undo")},"ctrl+y":w=>{w.preventDefault(),s.exec("redo")}}:{},[E,s]);return me?l.jsx(le.Locale,{children:l.jsx(je.Editor,{css:`wx-XkvqDXuw wx-gantt-editor ${I} ${o}`,items:v,values:me,topBar:P,bottomBar:m,placement:j,layout:r,readonly:c,autoSave:g,focus:R,onAction:Ce,onSave:te,onValidation:ie,onChange:ye,hotkeys:h&&{...oe,...h}})}):null}const St=({children:s,columns:n=null,api:o})=>{const[r,c]=e.useState(null);return e.useEffect(()=>{o&&o.getTable(!0).then(c)},[o]),l.jsx(Ve.HeaderMenu,{api:r,columns:n,children:s})};function Tt(s){const{api:n,content:o,children:r}=s,c=e.useRef(null),j=e.useRef(null),[m,x]=e.useState({}),[g,R]=e.useState(null),[h,G]=e.useState({});function C(S){for(;S;){if(S.getAttribute){const D=S.getAttribute("data-tooltip-id"),d=S.getAttribute("data-tooltip-at"),V=S.getAttribute("data-tooltip");if(D||V)return{id:D,tooltip:V,target:S,at:d}}S=S.parentNode}return{id:null,tooltip:null,target:null,at:null}}e.useEffect(()=>{const S=j.current;if(S&&h&&(h.text||o)){const D=S.getBoundingClientRect();let d=!1,V=h.left,_=h.top;D.right>=m.right&&(V=m.width-D.width-5,d=!0),D.bottom>=m.bottom&&(_=h.top-(D.bottom-m.bottom+2),d=!0),d&&G(Z=>Z&&{...Z,left:V,top:_})}},[h,m,o]);const u=e.useRef(null),O=300,N=S=>{clearTimeout(u.current),u.current=setTimeout(()=>{S()},O)};function P(S){let{id:D,tooltip:d,target:V,at:_}=C(S.target);if(G(null),R(null),!d)if(D)d=H(D);else{clearTimeout(u.current);return}const Z=S.clientX;N(()=>{D&&R($(I(D)));const B=V.getBoundingClientRect(),Q=c.current,K=Q?Q.getBoundingClientRect():{top:0,left:0,right:0,bottom:0,width:0,height:0};let A,U;_==="left"?(A=B.top+5-K.top,U=B.right+5-K.left):(A=B.top+B.height-K.top,U=Z-K.left),x(K),G({top:A,left:U,text:d})})}function $(S){return n?.getTask(I(S))||null}function H(S){return $(S)?.text||""}function I(S){const D=parseInt(S);return isNaN(D)?S:D}return l.jsxs("div",{className:"wx-KG0Lwsqo wx-tooltip-area",ref:c,onMouseMove:P,children:[h&&(h.text||o)?l.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip",ref:j,style:{top:`${h.top}px`,left:`${h.left}px`},children:o?l.jsx(o,{data:g}):h.text?l.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip-text",children:h.text}):null}):null,r]})}function Mt({fonts:s=!0,children:n}){return n?l.jsx(le.Material,{fonts:s,children:n()}):l.jsx(le.Material,{fonts:s})}function jt({fonts:s=!0,children:n}){return n?l.jsx(le.Willow,{fonts:s,children:n}):l.jsx(le.Willow,{fonts:s})}function Et({fonts:s=!0,children:n}){return n?l.jsx(le.WillowDark,{fonts:s,children:n}):l.jsx(le.WillowDark,{fonts:s})}const Rt="2.5.2",Nt={version:Rt},$t=Nt.version;Object.defineProperty(exports,"defaultColumns",{enumerable:!0,get:()=>re.defaultColumns});Object.defineProperty(exports,"defaultEditorItems",{enumerable:!0,get:()=>re.defaultEditorItems});Object.defineProperty(exports,"defaultMenuOptions",{enumerable:!0,get:()=>re.defaultMenuOptions});Object.defineProperty(exports,"defaultTaskTypes",{enumerable:!0,get:()=>re.defaultTaskTypes});Object.defineProperty(exports,"defaultToolbarButtons",{enumerable:!0,get:()=>re.defaultToolbarButtons});Object.defineProperty(exports,"getEditorItems",{enumerable:!0,get:()=>re.getEditorItems});Object.defineProperty(exports,"getMenuOptions",{enumerable:!0,get:()=>re.getMenuOptions});Object.defineProperty(exports,"getToolbarButtons",{enumerable:!0,get:()=>re.getToolbarButtons});Object.defineProperty(exports,"registerScaleUnit",{enumerable:!0,get:()=>re.registerScaleUnit});Object.defineProperty(exports,"registerEditorItem",{enumerable:!0,get:()=>je.registerEditorItem});exports.ContextMenu=kt;exports.Editor=Ct;exports.Gantt=pt;exports.HeaderMenu=St;exports.Material=Mt;exports.Toolbar=bt;exports.Tooltip=Tt;exports.Willow=jt;exports.WillowDark=Et;exports.version=$t;
//# sourceMappingURL=index.cjs.map
